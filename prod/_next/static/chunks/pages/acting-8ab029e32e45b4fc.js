(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2884],{2293:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>B});var t=a(37876),r=a(14232),n=a(8047),l=a(6960),c=a(48230),i=a.n(c),o=a(12293),d=a(83416),x=a(20451),m=a(9215),u=a(44769),N=a(20442),h=a(4066);let v=e=>{e.currentRound;var s=((0,r.useContext)(d.N)||{}).token,a=(0,m.lW)((null==s?void 0:s.address)||"","0x5b31D8A0676Ae756BF9CF5591bB2a9E8aB65F925"),n=a.balance,l=a.isPending,c=a.error,i=(0,u.bt)((null==s?void 0:s.address)||""),v=i.reward,j=i.isPending,f=i.error,p=(0,x.g)().handleContractError;return(0,r.useEffect)(()=>{c&&p(c,"join"),f&&p(f,"dataViewer")},[c,f]),(0,t.jsx)("div",{className:"px-4",children:(0,t.jsxs)("div",{className:"w-full border rounded-lg p-0",children:[(0,t.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,t.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,t.jsx)("div",{className:"stat-title text-sm pb-1",children:"参与行动代币总数"}),(0,t.jsx)("div",{className:"stat-value text-xl text-secondary",children:l?(0,t.jsx)(o.A,{}):(0,N.NJ)(n||BigInt(0))})]}),(0,t.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,t.jsx)("div",{className:"stat-title text-sm pb-1",children:"预计新增铸币"}),(0,t.jsx)("div",{className:"stat-value text-xl text-secondary",children:j?(0,t.jsx)(o.A,{}):(0,N.NJ)(v)})]})]}),(0,t.jsxs)("div",{className:"text-center text-xs mb-2 text-greyscale-500",children:["预估年化收益率（APY）：",l||j?(0,t.jsx)(o.A,{}):(0,h.BN)(v,n)]})]})})};var j=a(60154),f=a(91754),p=a(96108),g=a(28638),y=a(62288),b=a(18651),w=a(1709),_=a(87577);let A=e=>{var s=e.currentRound,a=((0,r.useContext)(d.N)||{}).token,l=(0,n.F)().address,c=(0,u.pX)((null==a?void 0:a.address)||"",s||0n,l),m=c.joinableActions,v=c.isPending,j=c.error,A=(0,y.CZ)((null==a?void 0:a.address)||""),C=A.rewardAvailable,E=A.isPending,B=A.error,k=(null==m?void 0:m.reduce((e,s)=>e+s.votesNum,0n))||0n,M=a?s-BigInt(a.initialStakeRound)+1n:0n,R=(0,h.u3)(C,M),I=(0,x.g)().handleContractError;return(0,r.useEffect)(()=>{j&&I(j,"dataViewer"),B&&I(B,"mint")},[j,B]),(0,t.jsxs)("div",{className:"px-4 py-6",children:[(0,t.jsx)(w.A,{title:"本轮可参与的行动："}),(0,t.jsx)(b.A,{currentRound:s,roundType:"act"}),!l&&(0,t.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"请先连接钱包"}),l&&v&&(0,t.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,t.jsx)(o.A,{})}),l&&!v&&!(null==m?void 0:m.length)&&(0,t.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"本轮暂无行动"}),!v&&m&&m.length>0&&(0,t.jsxs)("div",{className:"mt-2 space-y-4",children:[null==m?void 0:m.sort((e,s)=>{var a=Number(e.votesNum);return Number(s.votesNum)-a}).map((e,s)=>{var r=e.joinedAmountOfAccount>0n,n=Number(k)>0?Number(m[s].votesNum||0n)/Number(k):0,l=r?"/action/detail?id=".concat(e.action.head.id,"&type=join&symbol=").concat(null==a?void 0:a.symbol):"/acting/join?id=".concat(e.action.head.id,"&symbol=").concat(null==a?void 0:a.symbol);return(0,t.jsx)(g.Zp,{className:"shadow-none",children:(0,t.jsxs)(i(),{href:l,className:"relative block",children:[(0,t.jsxs)(g.aR,{className:"px-3 pt-2 pb-1 flex-row items-baseline",children:[(0,t.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,t.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.head.id)}),(0,t.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.body.title)})]}),(0,t.jsx)(g.Wu,{className:"px-3 pt-1 pb-2",children:(0,t.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(f.A,{className:"text-greyscale-400 mr-1 h-3 w-3 -translate-y-0.5"}),(0,t.jsx)("span",{className:"text-greyscale-400",children:(0,t.jsx)(_.A,{address:m[s].action.head.author,showCopyButton:!1,colorClassName2:"text-secondary"})})]}),e.hasReward?(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 mr-1",children:"预估年化(APY)"}),(0,t.jsx)("span",{className:"text-secondary",children:E?(0,t.jsx)(o.A,{}):(0,h.BN)(BigInt(Math.floor(Number(R||0n)*n)),m[s].joinedAmount)})]}):(0,t.jsx)("span",{className:"flex justify-between text-error text-sm",children:"无铸币奖励"}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 mr-1",children:"投票"}),(0,t.jsx)("span",{className:"text-secondary",children:(0,N.Ee)(100*n)})]})]})}),(0,t.jsx)(p.A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-greyscale-400 pointer-events-none"})]})},e.action.head.id)}),(0,t.jsxs)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:[(0,t.jsx)("span",{className:"text-red-500 font-bold",children:"提醒："}),(0,t.jsxs)("span",{children:["每个行动阶段，最后","8","个区块（约",(0,N.Xo)(Number("8")*Number("255")/100),"），无法参与行动报名"]})]})]})]})};var C=a(62537),E=a(17660);let B=()=>{var e=(0,n.F)().isConnected,s=((0,r.useContext)(d.N)||{}).token,a=e&&(null==s?void 0:s.hasEnded)===!0,c=(0,E.vC)(a),m=c.currentRound,u=c.error,N=c.isPending,h=(0,x.g)().handleContractError;return((0,r.useEffect)(()=>{u&&h(u,"join")},[u]),a&&N)?(0,t.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,t.jsx)(o.A,{})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.A,{title:"社区首页"}),(0,t.jsx)("main",{className:"flex-grow",children:e?s?s&&!s.hasEnded?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.A,{}),(0,t.jsxs)("div",{className:"flex flex-col items-center p-4 mt-4",children:[(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"公平发射未结束，还不能参与社区行动"}),(0,t.jsx)(l.$,{className:"w-1/2",asChild:!0,children:(0,t.jsx)(i(),{href:"/launch?symbol=".concat(s.symbol),children:"查看公平发射"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.A,{}),(0,t.jsx)(v,{currentRound:m}),(0,t.jsx)(A,{currentRound:m})]}):(0,t.jsx)(o.A,{}):(0,t.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})})]})}},4066:(e,s,a)=>{"use strict";a.d(s,{BN:()=>l,bD:()=>n,u$:()=>c,u3:()=>i});var t=a(20442),r=a(65575),n=(e,s,a)=>{if(!e||!s)return"0%";var n=31536e5/Number("255"),l=(0,r.oQ)("120");if(0===n||0n===l)return console.error("配置错误: NEXT_PUBLIC_BLOCK_TIME 或 NEXT_PUBLIC_PHASE_BLOCKS 未设置"),"0%";var c=e?99n*e*99n/2000000n:BigInt(0),i=(2n*s||BigInt(0))+(a||BigInt(0));if(i===BigInt(0))return"0%";var o=Number(c)/Number(i)/(Number(l)/n)*100;return(0,t.Ee)(o)},l=(e,s)=>{if(!e||!s||0n===s)return"∞";var a=31536e5/Number("255"),n=(0,r.oQ)("120");if(0===a||0n===n)return console.error("配置错误: BLOCK_TIME 或 PHASE_BLOCKS 未设置或为0"),"0%";var l=Number(e)/Number(s)/(Number(n)/a)*100;return(0,t.Ee)(l)},c=function(e){var s,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=Number("120")||0,r=Number("255")||0,n=e*t,l=Math.ceil(n*r/100);if(l>=86400){var c=Math.ceil(l/86400);s="".concat(c,"天")}else if(l>=3600){var i=Math.ceil(l/3600);s="".concat(i,"小时")}else{var o=Math.ceil(l/60);s="".concat(o,"分钟")}var d="".concat(n.toLocaleString(),"区块，约").concat(s);return a||(d="".concat(e,"个阶段（").concat(d,")")),d},i=(e,s)=>{if(!e)return BigInt(0);var a=1000n-(0,r.oQ)("1")-(0,r.oQ)("1"),t=BigInt(0);return s<=1n?e*(0,r.oQ)("1")/1000n:e*a*(0,r.oQ)("1")/1000000n}},18651:(e,s,a)=>{"use strict";a.d(s,{A:()=>d});var t=a(40854),r=a(37876),n=a(14232),l=a(63934),c=a(83416);let i=e=>{var s=e.initialTimeLeft,a=e.onTick,l=(0,t._)((0,n.useState)(Date.now()+1e3*s),2),c=l[0],i=l[1],o=(0,t._)((0,n.useState)(s),2),d=o[0],x=o[1];(0,n.useEffect)(()=>{i(Date.now()+1e3*s)},[s]),(0,n.useEffect)(()=>{var e=setInterval(()=>{var s=Math.max(0,Math.floor((c-Date.now())/1e3));x(s),a&&a(s),s<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[c,a]);var m=Math.floor(d/86400),u=Math.floor(d%86400/3600),N=Math.floor(d%3600/60);return(0,r.jsxs)("div",{className:"inline-flex gap-1 text-greyscale-400",children:[m>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"countdown font-mono",children:(0,r.jsx)("span",{style:{"--value":m}})}),"天"]}),(u>0||m>0)&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"countdown font-mono",children:(0,r.jsx)("span",{style:{"--value":u}})}),"时"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"countdown font-mono",children:(0,r.jsx)("span",{style:{"--value":N}})}),"分"]}),m<=0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"countdown font-mono",children:(0,r.jsx)("span",{style:{"--value":d%60}})}),"秒"]})]})};var o=a(12293);let d=e=>{var s=e.currentRound,a=e.roundType,d=e.showCountdown,x=(0,l.y)().data,m=(0,n.useContext)(c.N),u=m?m.token:void 0,N=!x||!u||void 0===u.voteOriginBlocks,h=(0,t._)((0,n.useState)(0n),2),v=h[0],j=h[1],f=Number("120")||0,p=Number("255")||0,g=u?Number(u.voteOriginBlocks):0,y=f-(Number(x)-g)%f,b=y>0?Math.ceil(y*p/100):0,w=(0,t._)((0,n.useState)(b),2),_=w[0],A=w[1];(0,n.useEffect)(()=>{if(x){var e=f-(Number(x)-g)%f;A(e>0?Math.ceil(e*p/100):0)}},[x,f,p,g]),(0,n.useEffect)(()=>{s>0n&&j(s)},[s]);var C=null!=v?v.toString():"0";return v<=0n?(0,r.jsx)(r.Fragment,{}):N||null==v||v<0n?((null==v||v<0n)&&(console.log("currentTokenRound",v),console.log("currentRound",s)),(0,r.jsx)(o.A,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["( 第",(0,r.jsx)("span",{className:"text-greyscale-400",children:C}),"轮","vote"===a?"投票":"verify"===a?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(100*_/p)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(i,{initialTimeLeft:b,onTick:A})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:_<60?"".concat(_,"秒"):_<=300?"".concat(Math.floor(_/60),"分钟").concat(_%60,"秒"):_<3600?"".concat(Math.floor(_/60),"分钟"):"".concat(Math.floor(_/3600),"小时").concat(Math.floor(_%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:" )"})]})})}},28638:(e,s,a)=>{"use strict";a.d(s,{BT:()=>x,Wu:()=>m,ZB:()=>d,Zp:()=>i,aR:()=>o,wL:()=>u});var t=a(3576),r=a(65699),n=a(37876),l=a(14232),c=a(30684),i=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a)},l))});i.displayName="Card";var o=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",a)},l))});o.displayName="CardHeader";var d=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",a)},l))});d.displayName="CardTitle";var x=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("text-sm text-muted-foreground",a)},l))});x.displayName="CardDescription";var m=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("p-6 pt-0",a)},l))});m.displayName="CardContent";var u=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("flex items-center p-6 pt-0",a)},l))});u.displayName="CardFooter"},45839:(e,s,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting",function(){return a(2293)}])},75695:(e,s,a)=>{"use strict";a.d(s,{A:()=>u});var t=a(16927),r=a(40854),n=a(4902),l=a(37876),c=a(14232),i=a(7446),o=a(95167),d=a(8047),x=a(44571),m=a(97685);function u(e){var s=e.tokenAddress,a=e.tokenSymbol,u=e.tokenDecimals,N=e.tokenImage,h=(0,r._)((0,c.useState)(!1),2),v=h[0],j=h[1],f=(0,d.F)().isConnected,p=(0,x.G)().data;return a.length>11?null:(0,l.jsx)("button",{onClick:()=>(0,t._)(function(){return(0,n.YH)(this,function(e){switch(e.label){case 0:if(!f)return alert("请先连接你的钱包"),[2];j(!0),e.label=1;case 1:if(e.trys.push([1,3,4,5]),!p)return alert("无法获取钱包客户端"),[2];return[4,p.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:s,symbol:a,decimals:u,image:N}}})];case 2:return e.sent()?m.Ay.success("代币已成功添加到 MetaMask 钱包"):m.Ay.error("用户拒绝添加代币"),[3,5];case 3:return console.error("添加代币失败:",e.sent()),m.Ay.error("添加代币失败，请检查控制台以获取更多信息"),[3,5];case 4:return j(!1),[7];case 5:return[2]}})})(),disabled:v,className:"flex items-center justify-center p-1 rounded hover:bg-gray-200 focus:outline-none",children:v?(0,l.jsx)(i.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(o.A,{className:"h-4 w-4 text-greyscale-500"})})}},91754:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var t=(0,a(11713).A)("UserPen",[["path",{d:"M11.5 15H7a4 4 0 0 0-4 4v2",key:"15lzij"}],["path",{d:"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1817ys"}],["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}]])}},e=>{e.O(0,[3308,7460,8230,4571,5701,5060,154,3096,4769,5139,2288,7432,2537,636,6593,8792],()=>e(e.s=45839)),_N_E=e.O()}]);