try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3472c0c7-7adf-469a-a0be-91424aa9a8df",e._sentryDebugIdIdentifier="sentry-dbid-3472c0c7-7adf-469a-a0be-91424aa9a8df")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7690],{81130:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify/action",function(){return t(27238)}])},74089:function(e,n,t){"use strict";var s=t(91309),r=t(85893),a=t(67294);n.Z=function(e){var n=e.initialTimeLeft,t=e.onTick,c=e.forceShowSeconds,i=e.fontClass,l=void 0===i?"":i,o=(0,s._)((0,a.useState)(Date.now()+1e3*n),2),d=o[0],u=o[1],x=(0,s._)((0,a.useState)(n),2),f=x[0],h=x[1];(0,a.useEffect)(function(){u(Date.now()+1e3*n)},[n]),(0,a.useEffect)(function(){var e=setInterval(function(){var n=Math.max(0,Math.floor((d-Date.now())/1e3));h(n),t&&t(n),n<=0&&(clearInterval(e),window.location.reload())},1e3);return function(){return clearInterval(e)}},[d,t]);var m=Math.floor(f/86400),j=Math.floor(f%86400/3600);return(0,r.jsxs)("span",{className:"inline-flex space-x-1 text-greyscale-400",children:[m>0&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(l),children:(0,r.jsx)("span",{style:{"--value":m}})}),(0,r.jsx)("span",{className:l,children:"天"})]}),(j>0||m>0)&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(l),children:(0,r.jsx)("span",{style:{"--value":j}})}),(0,r.jsx)("span",{className:l,children:"时"})]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(l),children:(0,r.jsx)("span",{style:{"--value":Math.floor(f%3600/60)}})}),(0,r.jsx)("span",{className:l,children:"分"})]}),(m<=0||void 0!==c&&c)&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"countdown font-mono ".concat(l),children:(0,r.jsx)("span",{style:{"--value":f%60}})}),(0,r.jsx)("span",{className:l,children:"秒"})]})]})}},64777:function(e,n,t){"use strict";var s=t(85893);n.Z=function(e){var n=e.title;return(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-lg font-bold",children:n})})}},21338:function(e,n,t){"use strict";var s=t(91309),r=t(85893),a=t(67294),c=t(88504),i=t(93778),l=t(74089),o=t(42083);n.Z=function(e){var n=e.currentRound,t=e.roundType,d=e.showCountdown,u=(0,c.O)().data,x=(0,a.useContext)(i.M),f=x?x.token:void 0,h=!u||!f||void 0===f.voteOriginBlocks,m=(0,s._)((0,a.useState)(BigInt(0)),2),j=m[0],g=m[1],v=Number("30126")||0,p=Number("2868")||0,y=f?Number(f.voteOriginBlocks):0,N=v-(Number(u)-y)%v,b=N>0?Math.ceil(N*p/1e3):0,I=(0,s._)((0,a.useState)(b),2),w=I[0],B=I[1];(0,a.useEffect)(function(){if(u){var e=v-(Number(u)-y)%v;B(e>0?Math.ceil(e*p/1e3):0)}},[u,v,p,y]),(0,a.useEffect)(function(){n>BigInt(0)&&g(n)},[n]);var _=null!=j?j.toString():"0";return j<=BigInt(0)?(0,r.jsx)(r.Fragment,{}):h||null==j||j<BigInt(0)?(null==j||BigInt(0),(0,r.jsx)(o.Z,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["( 第",(0,r.jsx)("span",{className:"text-greyscale-400",children:_}),"轮","vote"===t?"投票":"verify"===t?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(1e3*w/p)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===d||d?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(l.Z,{initialTimeLeft:b,onTick:B})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:w<60?"".concat(w,"秒"):w<=300?"".concat(Math.floor(w/60),"分钟").concat(w%60,"秒"):w<3600?"".concat(Math.floor(w/60),"分钟"):"".concat(Math.floor(w/3600),"小时").concat(Math.floor(w%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:" )"})]})})}},27238:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return O}});var s=t(91309),r=t(85893),a=t(11163),c=t(67294),i=t(87250),l=t(73591),o=t(93778),d=t(83494),u=t(20725),x=t(64777),f=t(42130),h=t(7080),m=t(91529),j=t(42083),g=function(e){var n=e.currentRound,t=e.actionId,s=e.onRemainingVotesChange,a=((0,c.useContext)(o.M)||{}).token,d=(0,f.m)().address,u=(0,h.Ol)(null==a?void 0:a.address,n,d||"",t),x=u.votesNumByAccountByActionId,g=u.isPending,v=u.error,p=(0,i.Tl)(null==a?void 0:a.address,n,d||"",t),y=p.scoreByVerifierByActionId,N=p.isPending,b=p.error,I=g||N?BigInt(0):x-y;(0,c.useEffect)(function(){g||N||null==s||s(I)},[I,g,N]);var w=(0,l.S)().handleContractError;return((0,c.useEffect)(function(){v&&w(v,"vote"),b&&w(b,"verify")},[v,b]),I<=0)?(0,r.jsx)(r.Fragment,{}):(0,r.jsx)("div",{className:"px-4",children:(0,r.jsxs)("div",{className:"text-center bg-greyscale-100 p-4 rounded-lg",children:[(0,r.jsxs)("span",{className:"text-greyscale-800 text-base",children:["我的剩余验证票数：",g||N?(0,r.jsx)(j.Z,{}):(0,r.jsx)("span",{className:"text-secondary",children:(0,m.LH)(I)})]}),(0,r.jsx)("div",{className:"mt-2 text-sm text-greyscale-500 text-center",children:"提示: 您的验证票，将按“打分比例”分配给行动参与者"})]})})},v=t(21338),p=t(75766),y=t(72253),N=t(14932),b=t(27245),I=t(86501),w=t(39360),B=t(93950),_=t(27460),C=t(44576),E=t(72107),k=t(40330),Z=function(e){var n=e.currentRound,t=e.actionId,d=e.actionInfo,u=e.remainingVotes,x=((0,c.useContext)(o.M)||{}).token;(0,w.x)(),(0,a.useRouter)();var f=(0,B.X5)(null==x?void 0:x.address,n,t),h=f.verificationInfos,g=f.isPending,v=f.error,Z=(0,s._)((0,c.useState)({}),2),S=Z[0],M=Z[1],P=(0,s._)((0,c.useState)("0"),2),O=P[0],R=P[1];(0,c.useEffect)(function(){if(h&&h.length>0){var e={};h.forEach(function(n){e[n.account]=""}),M(e),R("")}},[h]);var T=function(){var e=Object.values(S).map(function(e){return parseInt(e)||0}),n=parseInt(O)||0,t=e.reduce(function(e,n){return e+n},0)+n;if(0===t)return{addressPercentages:{},abstainPercentage:0};var s={};return Object.keys(S).forEach(function(e){var n=parseInt(S[e])||0;s[e]=n/t*100}),{addressPercentages:s,abstainPercentage:n/t*100}}(),A=T.addressPercentages,D=T.abstainPercentage,L=function(e,n){(""===n||/^[0-9]+$/.test(n))&&M((0,N._)((0,y._)({},S),(0,p._)({},e,n)))},V=function(e){(""===e||/^[0-9]+$/.test(e))&&R(e)},F=(0,i.yl)(),q=F.verify,K=F.isPending,z=F.isConfirming,X=F.isConfirmed,Y=F.writeError;(0,c.useEffect)(function(){X&&!Y&&(I.Am.success("提交成功",{duration:2e3}),setTimeout(function(){k.N.reloadWithOverlay()},2e3))},[X,Y]);var W=(0,l.S)().handleContractError;return(0,c.useEffect)(function(){Y&&W(Y,"verify"),v&&W(v,"dataViewer")},[Y,v]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-full max-w-2xl",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("th",{className:"pb-3 text-left text-sm text-greyscale-500",children:"被抽中的行动参与者"}),(0,r.jsx)("th",{className:"pb-3 pl-2 text-left whitespace-nowrap w-20 text-sm text-greyscale-500",children:"打分"}),(0,r.jsx)("th",{className:"pb-3 text-center whitespace-nowrap w-16 text-sm text-greyscale-500",children:"分配"})]})}),(0,r.jsxs)("tbody",{children:[g&&(0,r.jsx)(j.Z,{}),h&&h.length>0?h.map(function(e,n){return(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("td",{className:"py-2",children:(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"font-mono",children:(0,r.jsx)(_.Z,{address:e.account})}),d&&(0,r.jsx)("div",{className:"text-sm text-greyscale-800",children:d.body.verificationKeys.map(function(n,t){return(0,r.jsxs)("div",{children:[n,": ",(0,r.jsx)(E.L,{text:e.infos[t]})]},t)})})]})}),(0,r.jsx)("td",{className:"py-2 w-20",children:(0,r.jsxs)("div",{className:"flex items-center text-left",children:[(0,r.jsx)("input",{type:"number",min:"0",value:S[e.account]||"",placeholder:"0",onChange:function(n){return L(e.account,n.target.value)},className:"w-11 px-1 py-1 border rounded",disabled:K||X}),(0,r.jsx)("span",{className:"text-greyscale-500 text-sm",children:"分"})]})}),(0,r.jsx)("td",{className:"py-2 text-center w-16 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-greyscale-500 text-sm",children:(0,m.rl)(A[e.account]||0)})})]},e.account)}):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:3,className:"text-center py-4",children:"暂无数据"})}),h&&(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"py-2",children:(0,r.jsx)("div",{className:"text-left",children:(0,r.jsx)("div",{className:"text-sm text-greyscale-800",children:(0,r.jsx)("span",{children:"弃权票数："})})})}),(0,r.jsx)("td",{className:"py-2 w-20",children:(0,r.jsxs)("div",{className:"flex items-center text-left",children:[(0,r.jsx)("input",{type:"number",min:"0",value:O,placeholder:"0",onChange:function(e){return V(e.target.value)},className:"w-11 px-1 py-1 border rounded",disabled:K||X}),(0,r.jsx)("span",{className:"text-greyscale-500 text-sm",children:"分"})]})}),(0,r.jsx)("td",{className:"py-2 text-center w-16 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-greyscale-500 text-sm",children:(0,m.rl)(D)})})]})]})]})}),(0,r.jsxs)(b.z,{onClick:function(){if(u<=BigInt(2)?(I.Am.error("剩余票数不足，无法验证"),!1):!Object.values(S).every(function(e){return 0===parseInt(e)||""===e})||0!==parseInt(O)&&""!==O||(I.Am.error("请至少给一个地址或弃权投票打分"),!1)){var e=Object.values(S).reduce(function(e,n){return e+(parseInt(n)||0)},0)+(parseInt(O)||0),n=[],s=BigInt(0);h.forEach(function(t,r){var a=parseInt(S[t.account])||0,c=BigInt(Math.floor(Number(u)*(a/e)));if((s+=c)>u){var i=s-u;s-=i,n.push(c-i)}else n.push(c)});var r=n.reduce(function(e,n){return e+n},BigInt(0));if(parseInt(O)>0){var a=u>r?u-r:BigInt(0);q(null==x?void 0:x.address,t,a,n)}else{if(r<u){var c=n.findIndex(function(e){return e>BigInt(0)});-1!==c&&(n[c]+=u-r)}q(null==x?void 0:x.address,t,BigInt(0),n)}}},disabled:K||z||X,className:"mt-6 w-1/2",children:[!K&&!z&&!X&&"提交验证",K&&"提交中...",z&&"确认中...",X&&"已验证"]}),(0,r.jsx)(C.Z,{isLoading:K||z,text:K?"提交交易...":"确认交易..."})]})},S=t(42171),M=t(4307),P=function(e){var n=e.currentRound,t=e.actionId,a=e.actionInfo,d=((0,c.useContext)(o.M)||{}).token,u=(0,f.m)().address,g=(0,s._)((0,c.useState)(new Set),2),p=g[0],b=g[1],I=(0,i.LW)(null==d?void 0:d.address,n,t,"0x0000000000000000000000000000000000000000"),w=I.scoreByActionIdByAccount,C=I.isPending,k=I.error,Z=(0,B.pK)(null==d?void 0:d.address,n,t),P=Z.verifiedAddresses,O=Z.isPending,R=Z.error,T=(0,B.X5)(null==d?void 0:d.address,n,t),A=T.verificationInfos,D=T.isPending,L=T.error,V=(0,h.wD)(null==d?void 0:d.address,n,t),F=V.votesNumByActionId,q=(V.isPending,V.error),K=(0,l.S)().handleContractError;(0,c.useEffect)(function(){R&&K(R,"dataViewer"),L&&K(L,"dataViewer"),k&&K(k,"verify"),q&&K(q,"vote")},[R,L,k,q]);var z=function(e){var n=new Set(p);n.has(e)?n.delete(e):n.add(e),b(n)},X=(null==P?void 0:P.reduce(function(e,n){return e+n.score},BigInt(0)))||BigInt(0),Y=(Number(X)+Number(w||BigInt(0)))/Number(F||BigInt(0))*100;return(0,r.jsxs)("div",{className:"relative px-4 pb-4 w-full",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(x.Z,{title:"当前轮最新验证结果"}),(0,r.jsxs)("span",{className:"text-sm text-greyscale-500 ml-2",children:["(验证进度：",(0,m.rl)(Y),")"]})]}),(0,r.jsx)("div",{className:"flex justify-left mt-2",children:(0,r.jsx)(v.Z,{currentRound:n,roundType:"verify"})}),D||O||C?(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)(j.Z,{})}):A&&0!==A.length?(0,r.jsxs)("table",{className:"table w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("th",{}),(0,r.jsx)("th",{children:"被抽中地址"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,r.jsx)("th",{className:"px-1 text-right",children:"验证票占比"})]})}),(0,r.jsxs)("tbody",{children:[A.map(function(e){var n=null==P?void 0:P.find(function(n){return n.account===e.account});return(0,N._)((0,y._)({},e),{score:(null==n?void 0:n.score)||BigInt(0)})}).sort(function(e,n){return e.score>n.score?-1:e.score<n.score?1:0}).map(function(e){var n=null==P?void 0:P.find(function(n){return n.account===e.account}),t=p.has(e.account);return(0,r.jsxs)(c.Fragment,{children:[(0,r.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===u?"text-secondary":""),children:[(0,r.jsx)("td",{className:"px-1 w-8",children:(0,r.jsx)("button",{onClick:function(){return z(e.account)},className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,r.jsx)(S.Z,{size:16}):(0,r.jsx)(M.Z,{size:16})})}),(0,r.jsx)("td",{className:"px-1",children:(0,r.jsx)(_.Z,{address:e.account,showCopyButton:!0,word:e.account===u?"(我)":""})}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)((null==n?void 0:n.score)||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,m.rl)(Number((null==n?void 0:n.score)||BigInt(0))/Number(X||BigInt(0))*100)})]}),a&&t&&(0,r.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,r.jsx)("td",{}),(0,r.jsx)("td",{colSpan:2,className:"px-1 py-3",children:(0,r.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,r.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),a.body.verificationKeys.map(function(n,t){return(0,r.jsxs)("div",{className:"mb-1",children:[(0,r.jsxs)("span",{className:"text-greyscale-500",children:[n,":"]})," ",(0,r.jsx)(E.L,{text:e.infos[t]})]},t)})]})})]})]},e.account)}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-1"}),(0,r.jsx)("td",{className:"px-1 text-greyscale-500",children:"弃权票"}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(w||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,m.rl)(Number(w||BigInt(0))/Number(X||BigInt(0))*100)})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-1"}),(0,r.jsx)("td",{className:"px-1 text-greyscale-500",children:"汇总 "}),(0,r.jsx)("td",{className:"px-1 text-right",children:(0,m.tY)(X||BigInt(0))}),(0,r.jsx)("td",{className:"px-1 text-right",children:"100%"})]})]})]}):(0,r.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有验证地址"})]})},O=function(){var e=BigInt((0,a.useRouter)().query.id||"0"),n=((0,c.useContext)(o.M)||{}).token,t=(0,i.Bk)(),f=t.currentRound,h=t.error,m=(0,l.S)().handleContractError;(0,c.useEffect)(function(){h&&m(h,"verify")},[h]);var p=(0,s._)((0,c.useState)(BigInt(-1)),2),y=p[0],N=p[1],b=(0,s._)((0,c.useState)(void 0),2),I=b[0],w=b[1];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{title:"验证",backUrl:"/verify/?symbol=".concat(null==n?void 0:n.symbol)}),(0,r.jsxs)("main",{className:"flex-grow",children:[y>0&&(0,r.jsxs)("div",{className:"px-4 pt-4",children:[(0,r.jsx)(x.Z,{title:"请分配您的验证票："}),(0,r.jsx)(v.Z,{currentRound:f,roundType:"verify",showCountdown:!1})]}),(0,r.jsx)(g,{currentRound:f,actionId:e,onRemainingVotesChange:function(e){N(e)}}),(0,r.jsxs)("div",{className:"flex flex-col items-center p-4",children:[y>BigInt(1)&&(0,r.jsx)(Z,{currentRound:f,actionId:e,actionInfo:I,remainingVotes:y}),y>=BigInt(0)&&y<=BigInt(1)&&(0,r.jsx)(P,{currentRound:f,actionId:e,actionInfo:I}),y<BigInt(0)&&(0,r.jsx)(j.Z,{})]}),(0,r.jsx)(u.Z,{actionId:e,round:BigInt(f||0),showSubmitter:!0,onActionInfo:w})]})]})}},88504:function(e,n,t){"use strict";t.d(n,{O:function(){return f}});var s=t(72253),r=t(14932),a=t(3628),c=t(97712),i=t(81946),l=t(36100),o=t(95159),d=t(39360),u=t(78942),x=t(63973);function f(){var e,n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=t.query,h=void 0===f?{}:f,m=t.watch,j=(0,u.Z)(t),g=(0,a.NL)(),v=(0,d.x)({config:j}),p=null!==(e=t.chainId)&&void 0!==e?e:v,y=function(e,n={}){return{gcTime:0,async queryFn({queryKey:n}){let{scopeKey:t,...s}=n[1];return await function(e,n={}){let{chainId:t,...s}=n,r=e.getClient({chainId:t});return(0,i.s)(r,c.z,"getBlockNumber")(s)}(e,s)??null},queryKey:function(e={}){return["blockNumber",(0,l.OP)(e)]}(n)}}(j,(0,r._)((0,s._)({},t),{chainId:p}));return(0,x.x)((0,r._)((0,s._)({},(0,s._)({config:t.config,chainId:t.chainId},"object"==typeof m?m:{})),{enabled:!!((null===(n=h.enabled)||void 0===n||n)&&("object"==typeof m?m.enabled:m)),onBlockNumber:function(e){g.setQueryData(y.queryKey,e)}})),(0,o.aM)((0,s._)({},h,y))}},63973:function(e,n,t){"use strict";t.d(n,{x:function(){return u}});var s=t(72253),r=t(14932),a=t(47702),c=t(65185),i=t(81946),l=t(67294),o=t(39360),d=t(78942);function u(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.enabled,u=void 0===t||t,x=n.onBlockNumber,f=(n.config,(0,a._)(n,["enabled","onBlockNumber","config"])),h=(0,d.Z)(n),m=(0,o.x)({config:h}),j=null!==(e=n.chainId)&&void 0!==e?e:m;(0,l.useEffect)(function(){if(u&&x)return function(e,n){let t,s;let{syncConnectedChain:r=e._internal.syncConnectedChain,...a}=n,l=n=>{t&&t();let s=e.getClient({chainId:n});return t=(0,i.s)(s,c.q,"watchBlockNumber")(a)},o=l(n.chainId);return r&&!n.chainId&&(s=e.subscribe(({chainId:e})=>e,async e=>l(e))),()=>{o?.(),s?.()}}(h,(0,r._)((0,s._)({},f),{chainId:j,onBlockNumber:x}))},[j,h,u,x,f.onError,f.emitMissed,f.emitOnBegin,f.poll,f.pollingInterval,f.syncConnectedChain])}}},function(e){e.O(0,[8239,367,3494,2252,3950,7724,7250,5370,2888,9774,179],function(){return e(e.s=81130)}),_N_E=e.O()}]);