try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="34c12499-a774-4f5e-8709-3f38196502a2",e._sentryDebugIdIdentifier="sentry-dbid-34c12499-a774-4f5e-8709-3f38196502a2")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3487],{66030:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting/join",function(){return t(82599)}])},83149:function(e,n,t){"use strict";t.d(n,{l0:function(){return b},NI:function(){return I},pf:function(){return _},Wi:function(){return p},xJ:function(){return N},lX:function(){return j},zG:function(){return w}});var r=t(34788),i=t(12796),s=t(72253),a=t(14932),o=t(47702),c=t(85893),l=t(67294),d=t(88426),u=t(87536),f=t(80513),m=t(49102),x=(0,t(12003).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),v=l.forwardRef(function(e,n){var t=e.className,r=(0,o._)(e,["className"]);return(0,c.jsx)(m.f,(0,s._)({ref:n,className:(0,f.cn)(x(),t)},r))});v.displayName=m.f.displayName;var b=u.RV,h=l.createContext({}),p=function(e){var n=(0,r._)({},(0,i._)(e));return(0,c.jsx)(h.Provider,{value:{name:n.name},children:(0,c.jsx)(u.Qr,(0,s._)({},n))})},g=function(){var e=l.useContext(h),n=l.useContext(y),t=(0,u.Gc)(),r=t.getFieldState,i=t.formState,a=r(e.name,i);if(!e)throw Error("useFormField should be used within <FormField>");var o=n.id;return(0,s._)({id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message")},a)},y=l.createContext({}),N=l.forwardRef(function(e,n){var t=e.className,r=(0,o._)(e,["className"]),i=l.useId();return(0,c.jsx)(y.Provider,{value:{id:i},children:(0,c.jsx)("div",(0,s._)({ref:n,className:(0,f.cn)("space-y-2",t)},r))})});N.displayName="FormItem";var j=l.forwardRef(function(e,n){var t=e.className,r=(0,o._)(e,["className"]),i=g(),a=i.error,l=i.formItemId;return(0,c.jsx)(v,(0,s._)({ref:n,className:(0,f.cn)(a&&"text-destructive",t),htmlFor:l},r))});j.displayName="FormLabel";var I=l.forwardRef(function(e,n){var t=(0,r._)({},(0,i._)(e)),a=g(),o=a.error,l=a.formItemId,u=a.formDescriptionId,f=a.formMessageId;return(0,c.jsx)(d.g7,(0,s._)({ref:n,id:l,"aria-describedby":o?"".concat(u," ").concat(f):"".concat(u),"aria-invalid":!!o},t))});I.displayName="FormControl";var _=l.forwardRef(function(e,n){var t=e.className,r=(0,o._)(e,["className"]),i=g().formDescriptionId;return(0,c.jsx)("p",(0,s._)({ref:n,id:i,className:(0,f.cn)("text-sm text-muted-foreground",t)},r))});_.displayName="FormDescription";var w=l.forwardRef(function(e,n){var t=e.className,r=e.children,i=(0,o._)(e,["className","children"]),l=g(),d=l.error,u=l.formMessageId,m=d?String(null==d?void 0:d.message):r;return m?(0,c.jsx)("p",(0,a._)((0,s._)({ref:n,id:u,className:(0,f.cn)("text-sm font-medium text-destructive",t)},i),{children:m})):null});w.displayName="FormMessage"},87861:function(e,n,t){"use strict";t.d(n,{g:function(){return c}});var r=t(72253),i=t(47702),s=t(85893),a=t(67294),o=t(80513),c=a.forwardRef(function(e,n){var t=e.className,a=(0,i._)(e,["className"]);return(0,s.jsx)("textarea",(0,r._)({className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n},a))});c.displayName="Textarea"},45090:function(e,n,t){"use strict";t.d(n,{Z:function(){return r}});var r=(0,t(1462).Z)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},82599:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return M}});var r=t(91309),i=t(85893),s=t(67294),a=t(11163),o=t(45090),c=t(38202),l=t(99522),d=t(99019),u=t(41192),f=t(81231),m=t(761),x=t(83446),v=t(11010),b=t(72253),h=t(14932),p=t(97582),g=t(56312),y=t(87536),N=t(63448),j=t(20975),I=t(86501),_=t(1504),w=t(45197),k=t(33582),B=t(87861),C=t(83149),S=t(907),E=t(81975),F=t(27431),A=t(41944),z=t(26749),R=function(e){var n,t=e.actionInfo,o=e.stakedAmount,c=(0,a.useRouter)(),f=((0,s.useContext)(u.M)||{}).token,x=(0,j.m)().address,R=(0,S.hS)(null==f?void 0:f.address,x),Z=R.balance,M=R.error,P=(0,S.yG)(null==f?void 0:f.address,x,"0x8CcBd2F82ce3Cd32acd6711f54521421F9bbb58B"),D=P.allowance,T=P.isPending,L=P.error,X=(0,F.Cv)((null==f?void 0:f.address)||"",BigInt(t.head.id),x),G=X.verificationKeys,J=X.verificationInfos,K=X.isPending,H=X.error,O=(0,r._)((0,s.useState)(!1),2),V=O[0],W=O[1],q=N.Ry({additionalStakeAmount:N.Z_().refine(function(e){return""===e.trim()||/^[0-9]+(?:,[0-9]{3})*(?:\.[0-9]+)?$/.test(e.trim())},{message:"请输入合法的数字格式"}).transform(function(e){return""===e.trim()?"0":e.trim().replace(/,/g,"")}).refine(function(e){return"0"!==e},{message:"参与代币数不能为 0"}).refine(function(e){var n=(0,d.vz)(e);return o&&o>BigInt(0)?null!==n&&n>BigInt(0):null!==n&&n>=BigInt(t.body.minStake)},{message:"参与代币数不能小于最小参与限制"}).refine(function(e){var n=(0,d.vz)(e);return null!==n&&void 0!==Z&&n<=Z},{message:"您的代币余额不足"}),verificationInfos:N.IX(N.Z_().min(1,{message:"验证信息不能为空"}))}),Q=t.body.verificationKeys.map(function(){return""}),U=(0,y.cI)({resolver:(0,g.F)(q),defaultValues:{additionalStakeAmount:"",verificationInfos:Q},mode:"onChange"});(0,s.useEffect)(function(){if(J&&J.length>0&&G){var e={};G.forEach(function(n,t){e[n]=J[t]});var n=t.body.verificationKeys.map(function(n){var t;return null!==(t=e[n])&&void 0!==t?t:""});U.setValue("verificationInfos",n)}},[J,G,U,t.body.verificationKeys]);var $=(0,S.yA)(null==f?void 0:f.address),Y=$.approve,ee=$.isPending,en=$.isConfirming,et=$.isConfirmed,er=$.writeError,ei=(0,s.useRef)(null),es=(0,s.useRef)(T);function ea(){return(ea=(0,v._)(function(e){var n,t;return(0,p.Jh)(this,function(r){switch(r.label){case 0:if((t=null!==(n=(0,d.vz)(e.additionalStakeAmount))&&void 0!==n?n:BigInt(0))===BigInt(0)&&o&&o>BigInt(0))return I.Am.error("当前无需授权。"),[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Y("0x8CcBd2F82ce3Cd32acd6711f54521421F9bbb58B",t)];case 2:case 3:return r.sent(),[3,4];case 4:return[2]}})})).apply(this,arguments)}(0,s.useEffect)(function(){es.current&&!T&&ei.current&&ei.current.blur(),es.current=T},[T]),(0,s.useEffect)(function(){et&&(W(!0),I.Am.success("授权".concat(null==f?void 0:f.symbol,"成功")))},[et,null==f?void 0:f.symbol]);var eo=U.watch("additionalStakeAmount"),ec=null!==(n=(0,d.vz)(eo||"0"))&&void 0!==n?n:BigInt(0);(0,s.useEffect)(function(){ec>BigInt(0)&&D&&D>BigInt(0)&&D>=ec?W(!0):W(!1)},[ec,T,D]);var el=(0,E.z7)(),ed=el.join,eu=el.isPending,ef=el.isConfirming,em=el.isConfirmed,ex=el.writeError;function ev(){return(ev=(0,v._)(function(e){var n,r,i;return(0,p.Jh)(this,function(s){switch(s.label){case 0:if(s.trys.push([0,2,,3]),n=!J||J.every(function(e){return!e||""===e.trim()}),r=e.verificationInfos,!n&&J&&G)G.length===e.verificationInfos.length&&G.every(function(n,t){var r=G.indexOf(n);return r>=0&&J[r]===e.verificationInfos[t]})&&(r=[]);else if(n&&e.verificationInfos.some(function(e){return!e||""===e.trim()}))return I.Am.error("首次提交需要填写所有验证信息"),[2];return[4,ed(null==f?void 0:f.address,BigInt(t.head.id),null!==(i=(0,d.vz)(e.additionalStakeAmount))&&void 0!==i?i:BigInt(0),r)];case 1:case 2:return s.sent(),[3,3];case 3:return[2]}})})).apply(this,arguments)}(0,s.useEffect)(function(){em&&(I.Am.success("加入成功"),U.reset(),setTimeout(function(){c.push("/my/myaction?id=".concat(t.head.id,"&symbol=").concat(null==f?void 0:f.symbol))},2e3))},[em]);var eb=(0,l.S)().handleContractError;return((0,s.useEffect)(function(){M&&eb(M,"token"),H&&eb(H,"join"),er&&eb(er,"token"),ex&&eb(ex,"join"),L&&eb(L,"token")},[M,H,er,ex,L]),K)?(0,i.jsx)(m.Z,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"px-6 pt-6 pb-2",children:[(0,i.jsx)(A.Z,{title:o?"增加参与代币":"参与行动"}),(0,i.jsx)(C.l0,(0,h._)((0,b._)({},U),{children:(0,i.jsxs)("form",{onSubmit:function(e){return e.preventDefault()},className:"space-y-4",children:[(0,i.jsx)(C.Wi,{control:U.control,name:"additionalStakeAmount",render:function(e){var n=e.field;return(0,i.jsxs)(C.xJ,{children:[(0,i.jsx)(C.lX,{className:"text-greyscale-500 font-normal",children:o?"":"参与代币数："}),(0,i.jsx)(C.NI,{children:(0,i.jsx)(k.I,(0,b._)({placeholder:o?"最大可追加 ".concat((0,d.LH)(Z||BigInt(0))):"最小参与代币数 ".concat((0,d.LH)(BigInt(t.body.minStake))),type:"number",disabled:!Z||Z<=BigInt(0),className:"!ring-secondary-foreground"},n))}),(0,i.jsx)(C.zG,{}),(0,i.jsxs)(C.pf,{className:"flex items-center",children:[(0,i.jsxs)("span",{children:["共有 ",(0,i.jsx)("span",{className:"text-secondary",children:(0,d.LH)(Z||BigInt(0))})," ",null==f?void 0:f.symbol]}),(0,i.jsx)(_.z,{type:"button",variant:"link",size:"sm",onClick:function(){Z&&Z>BigInt(0)&&U.setValue("additionalStakeAmount",(0,d.bM)(Z))},className:"text-secondary p-0 ml-6",disabled:!Z||Z<=BigInt(0),children:"全部"})]})]})}}),t.body.verificationKeys.map(function(e,n){return(0,i.jsx)(C.Wi,{control:U.control,name:"verificationInfos.".concat(n),render:function(r){var s=r.field;return(0,i.jsxs)(C.xJ,{children:[(0,i.jsx)(C.lX,{className:"text-greyscale-500 font-normal",children:e}),(0,i.jsx)(C.NI,{children:(0,i.jsx)(B.g,(0,b._)({placeholder:t.body.verificationInfoGuides[n]||"",className:"!ring-secondary-foreground"},s))}),(0,i.jsx)(C.zG,{})]})}},e+n)}),(0,i.jsxs)("div",{className:"flex justify-center space-x-4 pt-2",children:[(0,i.jsx)(_.z,{ref:ei,className:"w-1/2",disabled:T||ee||en||V,type:"button",onClick:function(){U.handleSubmit(function(e){return function(e){return ea.apply(this,arguments)}(e)})()},children:T?(0,i.jsx)(w.Z,{className:"animate-spin"}):ee?"1.提交中...":en?"1.确认中...":V?"1.".concat(null==f?void 0:f.symbol,"已授权"):"1.授权".concat(null==f?void 0:f.symbol)}),(0,i.jsx)(_.z,{className:"w-1/2",disabled:!V||eu||ef||em,type:"button",onClick:function(){U.handleSubmit(function(e){return function(e){return ev.apply(this,arguments)}(e)})()},children:eu?"2.提交中...":ef?"2.确认中...":em?"2.已加入":"2.加入"})]})]})}))]}),(0,i.jsx)("div",{className:"px-6 pt-0 pb-4",children:(0,i.jsx)("div",{className:"text-greyscale-500 text-sm",children:"提示：加入行动后，可以随时取回参与代币，无等待期"})}),(0,i.jsx)(z.Z,{isLoading:ee||en||eu||ef,text:ee||eu?"提交交易...":"确认交易..."})]})},Z=t(34155),M=function(){var e=(0,a.useRouter)().query.id,n=(0,r._)((0,s.useState)(void 0),2),t=n[0],v=n[1],b=((0,s.useContext)(u.M)||{}).token,h=(0,c.dI)(null==b?void 0:b.address,void 0===e?void 0:BigInt(e)),p=h.actionInfo,g=h.isPending,y=h.error,N=(0,l.S)().handleContractError;return(0,s.useEffect)(function(){y&&N(y,"submit")},[y]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{title:"加入行动",showBackButton:!0}),(0,i.jsx)("main",{className:"flex-grow",children:!e||Array.isArray(e)||g?(0,i.jsx)(m.Z,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{actionId:BigInt(e),actionInfo:p,onStakedAmountChange:function(e){v(e)},showJoinButton:!1}),(0,i.jsx)(R,{actionInfo:p,stakedAmount:t}),(0,i.jsx)("div",{className:"flex flex-col w-full p-4",children:(0,i.jsxs)("div",{className:"bg-blue-50/30 border-l-4 border-l-blue-50 rounded-r-lg p-4 mb-8 text-sm",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-base font-bold text-blue-800 pb-2",children:[(0,i.jsx)(o.Z,{className:"w-4 h-4"}),"小贴士"]}),(0,i.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"行动激励："}),(0,i.jsx)("div",{className:"text-sm text-blue-700",children:"1、验证阶段会随机抽取地址验证打分，然后按得分比例给这些地址分配代币激励"}),(0,i.jsxs)("div",{className:"text-sm text-blue-700",children:["2、只有当1个行动获得的投票数，达到该轮总投票数",(0,d.rl)(Number("30")/10),"时，参与该行动才有激励"]}),(0,i.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"参与代币："}),(0,i.jsx)("div",{className:"text-sm text-blue-700",children:"1、参与代币越多，被选中验证并获得激励的概率越大"}),(0,i.jsx)("div",{className:"text-sm text-blue-700",children:"2、参与的代币可随时取回，如不取回则自动参与此行动的后续轮次"}),(0,i.jsx)("div",{className:"text-base font-bold text-blue-700 pt-2 pb-1",children:"加入限制："}),(0,i.jsxs)("div",{className:"text-sm text-blue-700",children:["每个行动阶段，最后","8","个区块（约",(0,d.ZC)(Number("8")*Number(Z.env.NEXT_PUBLIC_BLOCK_TIME_MS)/1e3),"），无法参与行动报名"]})]})})]})})]})}}},function(e){e.O(0,[7395,6457,1617,8700,1985,7431,8430,4628,3614,2888,9774,179],function(){return e(e.s=66030)}),_N_E=e.O()}]);