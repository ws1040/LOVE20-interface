try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="9a68e123-2963-41eb-96cd-55de9b0ca982",e._sentryDebugIdIdentifier="sentry-dbid-9a68e123-2963-41eb-96cd-55de9b0ca982")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3594],{84455:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/new",function(){return n(98126)}])},34680:function(e,r,n){"use strict";n.d(r,{Ol:function(){return d},SZ:function(){return l},Zb:function(){return c},aY:function(){return f},eW:function(){return m},ll:function(){return u}});var t=n(72253),s=n(47702),i=n(85893),a=n(67294),o=n(40108),c=a.forwardRef(function(e,r){var n=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,t._)({ref:r,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n)},a))});c.displayName="Card";var d=a.forwardRef(function(e,r){var n=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,t._)({ref:r,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",n)},a))});d.displayName="CardHeader";var u=a.forwardRef(function(e,r){var n=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,t._)({ref:r,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",n)},a))});u.displayName="CardTitle";var l=a.forwardRef(function(e,r){var n=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,t._)({ref:r,className:(0,o.cn)("text-sm text-muted-foreground",n)},a))});l.displayName="CardDescription";var f=a.forwardRef(function(e,r){var n=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,t._)({ref:r,className:(0,o.cn)("p-6 pt-0",n)},a))});f.displayName="CardContent";var m=a.forwardRef(function(e,r){var n=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)("div",(0,t._)({ref:r,className:(0,o.cn)("flex items-center p-6 pt-0",n)},a))});m.displayName="CardFooter"},76929:function(e,r,n){"use strict";n.d(r,{l0:function(){return v},NI:function(){return _},pf:function(){return w},Wi:function(){return N},xJ:function(){return y},lX:function(){return b},zG:function(){return I}});var t=n(34788),s=n(12796),i=n(72253),a=n(14932),o=n(47702),c=n(85893),d=n(67294),u=n(88426),l=n(87536),f=n(40108),m=n(49102),x=(0,n(12003).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),h=d.forwardRef(function(e,r){var n=e.className,t=(0,o._)(e,["className"]);return(0,c.jsx)(m.f,(0,i._)({ref:r,className:(0,f.cn)(x(),n)},t))});h.displayName=m.f.displayName;var v=l.RV,g=d.createContext({}),N=function(e){var r=(0,t._)({},(0,s._)(e));return(0,c.jsx)(g.Provider,{value:{name:r.name},children:(0,c.jsx)(l.Qr,(0,i._)({},r))})},p=function(){var e=d.useContext(g),r=d.useContext(j),n=(0,l.Gc)(),t=n.getFieldState,s=n.formState,a=t(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");var o=r.id;return(0,i._)({id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message")},a)},j=d.createContext({}),y=d.forwardRef(function(e,r){var n=e.className,t=(0,o._)(e,["className"]),s=d.useId();return(0,c.jsx)(j.Provider,{value:{id:s},children:(0,c.jsx)("div",(0,i._)({ref:r,className:(0,f.cn)("space-y-2",n)},t))})});y.displayName="FormItem";var b=d.forwardRef(function(e,r){var n=e.className,t=(0,o._)(e,["className"]),s=p(),a=s.error,d=s.formItemId;return(0,c.jsx)(h,(0,i._)({ref:r,className:(0,f.cn)(a&&"text-destructive",n),htmlFor:d},t))});b.displayName="FormLabel";var _=d.forwardRef(function(e,r){var n=(0,t._)({},(0,s._)(e)),a=p(),o=a.error,d=a.formItemId,l=a.formDescriptionId,f=a.formMessageId;return(0,c.jsx)(u.g7,(0,i._)({ref:r,id:d,"aria-describedby":o?"".concat(l," ").concat(f):"".concat(l),"aria-invalid":!!o},n))});_.displayName="FormControl";var w=d.forwardRef(function(e,r){var n=e.className,t=(0,o._)(e,["className"]),s=p().formDescriptionId;return(0,c.jsx)("p",(0,i._)({ref:r,id:s,className:(0,f.cn)("text-sm text-muted-foreground",n)},t))});w.displayName="FormDescription";var I=d.forwardRef(function(e,r){var n=e.className,t=e.children,s=(0,o._)(e,["className","children"]),d=p(),u=d.error,l=d.formMessageId,m=u?String(null==u?void 0:u.message):t;return m?(0,c.jsx)("p",(0,a._)((0,i._)({ref:r,id:l,className:(0,f.cn)("text-sm font-medium text-destructive",n)},s),{children:m})):null});I.displayName="FormMessage"},76453:function(e,r,n){"use strict";n.d(r,{g:function(){return c}});var t=n(72253),s=n(47702),i=n(85893),a=n(67294),o=n(40108),c=a.forwardRef(function(e,r){var n=e.className,a=(0,s._)(e,["className"]);return(0,i.jsx)("textarea",(0,t._)({className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:r},a))});c.displayName="Textarea"},4270:function(e,r,n){"use strict";n.d(r,{Z:function(){return t}});var t=(0,n(31134).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},64777:function(e,r,n){"use strict";var t=n(85893);r.Z=function(e){var r=e.title;return(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsx)("h1",{className:"text-lg font-bold",children:r})})}},93566:function(e,r,n){"use strict";n.d(r,{$A:function(){return x},Bk:function(){return m},Xo:function(){return g},dI:function(){return f},qd:function(){return v},sK:function(){return h}});var t=n(11010),s=n(97582),i=n(67294),a=n(71104),o=n(7724),c=n(37742),d=n(84689),u=n(37474),l="0xeBB295af1D4ee9ed92e55EFF4ca5Eb8D4AB81aCE",f=function(e,r){var n=(0,a.u)({address:l,abi:o.d,functionName:"actionInfo",args:[e,r||BigInt(0)],query:{enabled:!!e&&void 0!==r}});return{actionInfo:n.data,isPending:n.isPending,error:n.error}},m=function(){var e=(0,a.u)({address:l,abi:o.d,functionName:"currentRound",args:[]}),r=e.data,n=e.isPending,t=e.error;return{currentRound:(0,c.Zu)(r),isPending:n,error:t}},x=function(e,r,n){var t=(0,a.u)({address:l,abi:o.d,functionName:"isSubmitted",args:[e,r,n]});return{isSubmitted:t.data,isPending:t.isPending,error:t.error}},h=function(e,r,n){var t=(0,a.u)({address:l,abi:o.d,functionName:"submitInfo",args:[e,r,n],query:{enabled:!!e&&!!r}});return{submitInfo:t.data,isPending:t.isPending,error:t.error}};function v(){var e,r=(0,u.e9)(o.d,l,"submit"),n=r.execute,a=r.isPending,c=r.isConfirming,f=r.isConfirmed,m=r.error,x=r.hash,h=r.isTukeMode,v=(e=(0,t._)(function(e,r){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,n([e,r])];case 1:return[2,t.sent()]}})}),function(r,n){return e.apply(this,arguments)});return(0,i.useEffect)(function(){m&&((0,d.Vh)(m),(0,d.H)(m))},[x,m,f]),{submit:v,isPending:a,isConfirming:c,writeError:m,isConfirmed:f,hash:x,isTukeMode:h}}function g(){var e,r=(0,u.e9)(o.d,l,"submitNewAction"),n=r.execute,a=r.isPending,c=r.isConfirming,f=r.isConfirmed,m=r.error,x=r.hash,h=r.isTukeMode,v=(e=(0,t._)(function(e,r){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,n([e,r])];case 1:return[2,t.sent()]}})}),function(r,n){return e.apply(this,arguments)});return(0,i.useEffect)(function(){m&&((0,d.Vh)(m),(0,d.H)(m))},[x,m,f]),{submitNewAction:v,isPending:a,isConfirming:c,writeError:m,isConfirmed:f,hash:x,isTukeMode:h}}},35312:function(e,r,n){"use strict";n.d(r,{C:function(){return d}});var t=n(67294),s=n(92180),i=n(93950),a=n(93778),o=n(42130),c=Number("3")/1e3,d=function(){var e=((0,t.useContext)(a.M)||{}).token,r=(0,o.m)().address,n=(0,s.Ty)((null==e?void 0:e.address)||"",r||""),d=n.validGovVotes,u=n.isPending,l=n.error,f=(0,i._H)(null==e?void 0:e.address),m=f.govData,x=f.isPending,h=f.error,v=(0,t.useMemo)(function(){return d&&(null==m?void 0:m.govVotes)&&m.govVotes!==BigInt(0)?Number(d)/Number(m.govVotes):0},[d,null==m?void 0:m.govVotes]);return{hasEnoughVotes:(0,t.useMemo)(function(){return v>=c},[v]),percentage:v,validGovVotes:d,govData:m,SUBMIT_MIN_PERCENTAGE:c,isPending:u||x,error:null!=l?l:h}}},98126:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return Z}});var t=n(11010),s=n(72253),i=n(14932),a=n(97582),o=n(85893),c=n(39360),d=n(67294),u=n(11163),l=n(87536),f=(0,n(31134).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),m=n(4270),x=n(63448),h=n(56312),v=n(27245),g=n(21774),N=n(76453),p=n(34680),j=n(76929),y=n(93566),b=n(73591),_=n(35312),w=n(93778),I=n(83494),C=n(17301),k=n(64777),P=n(44576),E=n(91529),R=Number("64"),M=Math.floor(R/3),A=function(e){return Array.from(e).length},F=x.Ry({actionName:x.Z_().min(1,{message:"行动名称不能为空"}).refine(function(e){return 20>=A(e)},{message:"行动名称不能超过20个字"}),verificationRule:x.Z_().min(1,{message:"验证规则不能为空"}).refine(function(e){return 1e4>=A(e)},{message:"验证规则不能超过10000字"}),verificationPairs:x.IX(x.Ry({key:x.Z_().min(1,{message:"验证名称不能为空"}).refine(function(e){return!!(!R||Number.isNaN(R))||new TextEncoder().encode(e).length<=R},{message:"关键词最多".concat(M,"个汉字或").concat(R,"个英文数字")}),value:x.Z_().min(1,{message:"验证信息提示不能为空"}).refine(function(e){return 1e3>=A(e)},{message:"验证信息内容（value）不能超过1000字"})})),rewardAddressCount:x.Z_().min(1,{message:"验证地址数不能为空"}).refine(function(e){return Number(e)>0},{message:"验证地址数必须大于0"}),minStake:x.Z_().min(1,{message:"最小参与代币数不能为空"}).refine(function(e){return Number(e)>0},{message:"最小参与代币数必须大于0"}),whiteListAddress:x.Z_().optional().refine(function(e){return!e||""===e.trim()||/^0x[a-fA-F0-9]{40}$/.test(e.trim())},{message:"白名单地址必须是有效的 0x 地址格式"})});function Z(){(0,c.x)();var e,r=((0,d.useContext)(w.M)||{}).token,n=(0,l.cI)({resolver:(0,h.F)(F),defaultValues:{actionName:"",verificationRule:"",verificationPairs:[{key:"",value:""}],rewardAddressCount:"",minStake:"",whiteListAddress:""},mode:"onChange"}),x=(0,l.Dq)({control:n.control,name:"verificationPairs"}),R=x.fields,M=x.append,A=x.remove,Z=(0,_.C)(),B=Z.hasEnoughVotes,S=Z.percentage,T=Z.validGovVotes,D=Z.govData,G=Z.SUBMIT_MIN_PERCENTAGE,V=Z.isPending,$=Z.error,z=(0,y.Xo)(),L=z.submitNewAction,X=z.isPending,J=z.isConfirming,W=z.isConfirmed,H=z.writeError,q=(e=(0,t._)(function(e){var t,s,i,o;return(0,a.Jh)(this,function(a){switch(a.label){case 0:if(!B)return t=(100*G).toFixed(2),n.setError("actionName",{type:"manual",message:"有效治理票，须达到总治理票的".concat(t,"%，才能新建、推举行动（您当前有效治理票为").concat(T,"，占比").concat((100*S).toFixed(2),"%）")}),[2];return s=e.verificationPairs.map(function(e){return e.key}),i=e.verificationPairs.map(function(e){return e.value}),o={minStake:e.minStake?(0,E.vz)(e.minStake):BigInt(0),maxRandomAccounts:e.rewardAddressCount?BigInt(e.rewardAddressCount):BigInt(0),whiteListAddress:e.whiteListAddress&&""!==e.whiteListAddress.trim()?e.whiteListAddress.trim():"0x0000000000000000000000000000000000000000",title:e.actionName,verificationRule:e.verificationRule,verificationKeys:s,verificationInfoGuides:i},[4,L(null==r?void 0:r.address,o)];case 1:return a.sent(),[2]}})}),function(r){return e.apply(this,arguments)}),O=(0,u.useRouter)();(0,d.useEffect)(function(){W&&O.push("/vote/?symbol=".concat(null==r?void 0:r.symbol))},[W,O,null==r?void 0:r.symbol]);var K=(0,b.S)().handleContractError;return(0,d.useEffect)(function(){$&&K($,"submit"),H&&K(H,"submit")},[$,H,K]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(I.Z,{title:"创建新行动",showBackButton:!0}),(0,o.jsxs)("div",{className:"max-w-xl p-4",children:[!B&&void 0!==T&&D&&(0,o.jsx)(C.Z,{type:"error",message:"有效治理票，须达到总治理票的".concat((100*G).toFixed(1),"%，才能新建、推举行动（您当前有效治理票为").concat((0,E.LH)(T),"，占比").concat((100*S).toFixed(2),"%））"),className:"mb-4"}),(0,o.jsx)(k.Z,{title:"创建新行动"}),(0,o.jsx)(j.l0,(0,i._)((0,s._)({},n),{children:(0,o.jsxs)("form",{onSubmit:n.handleSubmit(q),className:"mt-4 space-y-4",children:[(0,o.jsx)(j.Wi,{control:n.control,name:"actionName",render:function(e){var r=e.field;return(0,o.jsxs)(j.xJ,{children:[(0,o.jsx)(j.lX,{children:"行动名称"}),(0,o.jsx)(j.NI,{children:(0,o.jsx)(g.I,(0,s._)({type:"text",placeholder:"一句话说明行动",className:"!ring-secondary-foreground",maxLength:32},r))}),(0,o.jsx)(j.zG,{})]})}}),(0,o.jsx)(j.Wi,{control:n.control,name:"verificationRule",render:function(e){var r=e.field;return(0,o.jsxs)(j.xJ,{children:[(0,o.jsx)(j.lX,{children:"验证规则"}),(0,o.jsx)(j.NI,{children:(0,o.jsx)(N.g,(0,s._)({placeholder:"验证者，会根据这个规则来打分",rows:6,className:"!ring-secondary-foreground",maxLength:10010},r))}),(0,o.jsx)(j.zG,{})]})}}),(0,o.jsxs)("div",{children:[(0,o.jsx)(j.lX,{children:"报名参加行动时，行动者要提供的信息："}),(0,o.jsx)("div",{className:"space-y-4 mt-2",children:R.map(function(e,r){return(0,o.jsx)(p.Zb,{className:"overflow-hidden",children:(0,o.jsx)(p.aY,{className:"p-4",children:(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)(j.Wi,{control:n.control,name:"verificationPairs.".concat(r,".key"),render:function(e){var r=e.field;return(0,o.jsxs)(j.xJ,{className:"flex-grow",children:[(0,o.jsx)(j.NI,{children:(0,o.jsx)(g.I,(0,s._)({type:"text",placeholder:"名称，比如 '微博地址'",className:"!ring-secondary-foreground"},r))}),(0,o.jsx)(j.zG,{})]})}}),(0,o.jsx)(v.z,{variant:"ghost",size:"icon",onClick:function(){return A(r)},className:"flex-shrink-0",type:"button",children:(0,o.jsx)(f,{className:"h-4 w-4"})})]}),(0,o.jsx)(j.Wi,{control:n.control,name:"verificationPairs.".concat(r,".value"),render:function(e){var r=e.field;return(0,o.jsxs)(j.xJ,{children:[(0,o.jsx)(j.NI,{children:(0,o.jsx)(g.I,(0,s._)({type:"text",placeholder:"提示信息，比如 '例如 https://weibo.com/12345678'",className:"!ring-secondary-foreground",maxLength:1010},r))}),(0,o.jsx)(j.zG,{})]})}})]})})},e.id)})}),(0,o.jsx)("div",{className:"flex justify-center",children:(0,o.jsxs)(v.z,{type:"button",variant:"outline",onClick:function(){return M({key:"",value:""})},className:"w-1/2 mt-2 border-secondary text-secondary",children:[(0,o.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"添加验证信息"]})})]}),(0,o.jsx)(j.Wi,{control:n.control,name:"rewardAddressCount",render:function(e){var r=e.field;return(0,o.jsxs)(j.xJ,{children:[(0,o.jsx)(j.lX,{children:"最大激励地址数"}),(0,o.jsx)(j.NI,{children:(0,o.jsx)(g.I,(0,s._)({type:"number",placeholder:"地址数必须大于0",className:"!ring-secondary-foreground",autoComplete:"off"},r))}),(0,o.jsx)(j.zG,{})]})}}),(0,o.jsx)(j.Wi,{control:n.control,name:"minStake",render:function(e){var r=e.field;return(0,o.jsxs)(j.xJ,{children:[(0,o.jsx)(j.lX,{children:"最小参与代币数"}),(0,o.jsx)(j.NI,{children:(0,o.jsx)(g.I,(0,s._)({type:"number",placeholder:"最小参与代币数必须大于0",className:"!ring-secondary-foreground",autoComplete:"off"},r))}),(0,o.jsx)(j.zG,{})]})}}),(0,o.jsx)(j.Wi,{control:n.control,name:"whiteListAddress",render:function(e){var r=e.field;return(0,o.jsxs)(j.xJ,{children:[(0,o.jsx)(j.lX,{children:"白名单"}),(0,o.jsx)(j.NI,{children:(0,o.jsx)(g.I,(0,s._)({type:"text",placeholder:"不填为不限",className:"!ring-secondary-foreground"},r))}),(0,o.jsx)(j.zG,{})]})}}),(0,o.jsx)(v.z,{type:"submit",disabled:X||J||W||!B||V,className:"mt-4 w-full",children:X?"提交中...":J?"确认中...":W?"已提交":"提交"})]})})),(0,o.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 text-sm mt-4",children:[(0,o.jsx)("p",{className:"mb-1",children:"说明："}),(0,o.jsx)("p",{children:"1. 每个轮次，1个地址最多可以 创建/推举 1 个行动；"}),(0,o.jsx)("p",{children:"2. 创建后，会自动推举该行动；"})]})]}),(0,o.jsx)(P.Z,{isLoading:X||J,text:X?"提交交易...":"确认交易..."})]})}},21803:function(e,r,n){"use strict";function t(e,r){let[n,t="0"]=e.split("."),s=n.startsWith("-");if(s&&(n=n.slice(1)),t=t.replace(/(0+)$/,""),0===r)1===Math.round(Number(`.${t}`))&&(n=`${BigInt(n)+1n}`),t="";else if(t.length>r){let[e,s,i]=[t.slice(0,r-1),t.slice(r-1,r),t.slice(r)],a=Math.round(Number(`${s}.${i}`));(t=a>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${a}`).length>r&&(t=t.slice(1),n=`${BigInt(n)+1n}`),t=t.slice(0,r)}else t=t.padEnd(r,"0");return BigInt(`${s?"-":""}${n}${t}`)}n.d(r,{v:function(){return t}})}},function(e){e.O(0,[8239,367,1617,3494,2252,3950,2180,7724,2888,9774,179],function(){return e(e.s=84455)}),_N_E=e.O()}]);