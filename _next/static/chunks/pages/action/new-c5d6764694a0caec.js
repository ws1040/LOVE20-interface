(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{1709:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});var a=s(37876);let t=e=>{var r=e.title;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-lg font-bold",children:r})})}},18449:(e,r,s)=>{"use strict";s.d(r,{X:()=>n});var a=s(76200);class t extends a.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function n(e,r){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new t({value:e});let[s,a="0"]=e.split("."),n=s.startsWith("-");if(n&&(s=s.slice(1)),a=a.replace(/(0+)$/,""),0===r)1===Math.round(Number(`.${a}`))&&(s=`${BigInt(s)+1n}`),a="";else if(a.length>r){let[e,t,n]=[a.slice(0,r-1),a.slice(r-1,r),a.slice(r)],i=Math.round(Number(`${t}.${n}`));(a=i>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${i}`).length>r&&(a=a.slice(1),s=`${BigInt(s)+1n}`),a=a.slice(0,r)}else a=a.padEnd(r,"0");return BigInt(`${n?"-":""}${s}${a}`)}},28638:(e,r,s)=>{"use strict";s.d(r,{BT:()=>m,Wu:()=>u,ZB:()=>c,Zp:()=>d,aR:()=>o,wL:()=>x});var a=s(3576),t=s(65699),n=s(37876),i=s(14232),l=s(30684),d=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s)},i))});d.displayName="Card";var o=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s)},i))});o.displayName="CardHeader";var c=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s)},i))});c.displayName="CardTitle";var m=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("text-sm text-muted-foreground",s)},i))});m.displayName="CardDescription";var u=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("p-6 pt-0",s)},i))});u.displayName="CardContent";var x=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("div",(0,a._)({ref:r,className:(0,l.cn)("flex items-center p-6 pt-0",s)},i))});x.displayName="CardFooter"},40150:(e,r,s)=>{"use strict";s.d(r,{T:()=>d});var a=s(3576),t=s(65699),n=s(37876),i=s(14232),l=s(30684),d=i.forwardRef((e,r)=>{var s=e.className,i=(0,t._)(e,["className"]);return(0,n.jsx)("textarea",(0,a._)({className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r},i))});d.displayName="Textarea"},65104:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var a=(0,s(11713).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},70642:(e,r,s)=>{"use strict";s.d(r,{O:()=>o});var a=s(14232),t=s(19591),n=s(44769),i=s(83416),l=s(8047),d=Number("3")/1e3,o=()=>{var e=((0,a.useContext)(i.N)||{}).token,r=(0,l.F)().address,s=(0,t.Fd)((null==e?void 0:e.address)||"",r||""),o=s.validGovVotes,c=s.isPending,m=s.error,u=(0,n.W6)(null==e?void 0:e.address),x=u.govData,f=u.isPending,v=u.error,h=(0,a.useMemo)(()=>o&&(null==x?void 0:x.govVotes)&&0n!==x.govVotes?Number(o)/Number(x.govVotes):0,[o,null==x?void 0:x.govVotes]);return{hasEnoughVotes:(0,a.useMemo)(()=>h>=d,[h]),percentage:h,validGovVotes:o,govData:x,SUBMIT_MIN_PERCENTAGE:d,isPending:c||f,error:null!=m?m:v}}},71778:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>E});var a=s(16927),t=s(3576),n=s(62701),i=s(4902),l=s(37876),d=s(8047),o=s(14232),c=s(89099),m=s(88992),u=(0,s(11713).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),x=s(65104),f=s(22442),v=s(13810),h=s(6960),N=s(77932),p=s(40150),g=s(28638),j=s(92659),y=s(64115),b=s(20451),w=s(70642),_=s(83416),C=s(60154),I=s(91323),k=s(1709),R=s(99574),A=s(42038),M=s(20442),F=f.Ik({actionName:f.Yj().min(1,{message:"行动名称不能为空"}),verificationRule:f.Yj().min(1,{message:"验证规则不能为空"}),verificationPairs:f.YO(f.Ik({key:f.Yj().min(1,{message:"验证名称不能为空"}),value:f.Yj().min(1,{message:"验证信息提示不能为空"})})),rewardAddressCount:f.Yj().min(1,{message:"奖励地址数不能为空"}).refine(e=>Number(e)>0,{message:"奖励地址数必须大于0"}),minStake:f.Yj().min(1,{message:"最小参与代币数不能为空"}).refine(e=>Number(e)>0,{message:"最小参与代币数必须大于0"}),whiteListAddress:f.Yj().optional().refine(e=>!e||""===e.trim()||/^0x[a-fA-F0-9]{40}$/.test(e.trim()),{message:"白名单地址必须是有效的 0x 地址格式"})});function E(){var e=(0,d.F)().chain,r=((0,o.useContext)(_.N)||{}).token,s=(0,m.mN)({resolver:(0,v.u)(F),defaultValues:{actionName:"",verificationRule:"",verificationPairs:[{key:"",value:""}],rewardAddressCount:"",minStake:"",whiteListAddress:""},mode:"onChange"}),f=(0,m.jz)({control:s.control,name:"verificationPairs"}),E=f.fields,P=f.append,$=f.remove,B=(0,w.O)(),S=B.hasEnoughVotes,V=B.percentage,z=B.validGovVotes,L=B.govData,T=B.SUBMIT_MIN_PERCENTAGE,D=B.isPending,J=B.error,Y=(0,y.SU)(),O=Y.submitNewAction,W=Y.isPending,X=Y.isConfirming,G=Y.isConfirmed,H=Y.writeError,Z=(0,c.useRouter)();(0,o.useEffect)(()=>{G&&Z.push("/vote/?symbol=".concat(null==r?void 0:r.symbol))},[G,Z,null==r?void 0:r.symbol]);var U=(0,b.g)().handleContractError;return(0,o.useEffect)(()=>{J&&U(J,"submit"),H&&U(H,"submit")},[J,H,U]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(C.A,{title:"创建新行动"}),(0,l.jsxs)("div",{className:"max-w-xl p-4",children:[!S&&void 0!==z&&L&&(0,l.jsx)(I.A,{type:"error",message:"有效治理票，须达到总治理票的".concat((100*T).toFixed(1),"%，才能新建、推举行动（您当前有效治理票为").concat((0,M.NJ)(z),"，占比").concat((100*V).toFixed(2),"%））"),className:"mb-4"}),(0,l.jsx)(k.A,{title:"创建新行动"}),(0,l.jsx)(j.lV,(0,n._)((0,t._)({},s),{children:(0,l.jsxs)("form",{onSubmit:s.handleSubmit(t=>(0,a._)(function(){var a,n,l,d;return(0,i.YH)(this,function(i){switch(i.label){case 0:if(!(0,A.C)(e))return[2];if(!S)return a=(100*T).toFixed(2),s.setError("actionName",{type:"manual",message:"有效治理票，须达到总治理票的".concat(a,"%，才能新建、推举行动（您当前有效治理票为").concat(z,"，占比").concat((100*V).toFixed(2),"%）")}),[2];return n=t.verificationPairs.map(e=>e.key),l=t.verificationPairs.map(e=>e.value),d={minStake:t.minStake?(0,M.XS)(t.minStake):0n,maxRandomAccounts:t.rewardAddressCount?BigInt(t.rewardAddressCount):0n,whiteListAddress:t.whiteListAddress&&""!==t.whiteListAddress.trim()?t.whiteListAddress.trim():"0x0000000000000000000000000000000000000000",title:t.actionName,verificationRule:t.verificationRule,verificationKeys:n,verificationInfoGuides:l},[4,O(null==r?void 0:r.address,d)];case 1:return i.sent(),[2]}})})()),className:"mt-4 space-y-4",children:[(0,l.jsx)(j.zB,{control:s.control,name:"actionName",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"行动名称"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(N.p,(0,t._)({type:"text",placeholder:"一句话说明行动",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(j.zB,{control:s.control,name:"verificationRule",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"验证规则"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(p.T,(0,t._)({placeholder:"验证者，会根据这个规则来打分",rows:6,className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsxs)("div",{children:[(0,l.jsx)(j.lR,{children:"报名参加行动时，行动者要提供的信息"}),(0,l.jsx)("div",{className:"space-y-4 mt-2",children:E.map((e,r)=>(0,l.jsx)(g.Zp,{className:"overflow-hidden",children:(0,l.jsx)(g.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(j.zB,{control:s.control,name:"verificationPairs.".concat(r,".key"),render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{className:"flex-grow",children:[(0,l.jsx)(j.MJ,{children:(0,l.jsx)(N.p,(0,t._)({type:"text",placeholder:"名称，比如 '微博地址'",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(h.$,{variant:"ghost",size:"icon",onClick:()=>$(r),className:"flex-shrink-0",type:"button",children:(0,l.jsx)(u,{className:"h-4 w-4"})})]}),(0,l.jsx)(j.zB,{control:s.control,name:"verificationPairs.".concat(r,".value"),render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.MJ,{children:(0,l.jsx)(N.p,(0,t._)({type:"text",placeholder:"提示信息，比如 '例如 https://weibo.com/12345678'",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}})]})})},e.id))}),(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)(h.$,{type:"button",variant:"outline",onClick:()=>P({key:"",value:""}),className:"w-1/2 mt-2 border-secondary text-secondary",children:[(0,l.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"添加验证信息"]})})]}),(0,l.jsx)(j.zB,{control:s.control,name:"rewardAddressCount",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"奖励地址数"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(N.p,(0,t._)({type:"number",placeholder:"地址数必须大于0",className:"!ring-secondary-foreground",autoComplete:"off"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(j.zB,{control:s.control,name:"minStake",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"最小参与代币数"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(N.p,(0,t._)({type:"number",placeholder:"最小参与代币数必须大于0",className:"!ring-secondary-foreground",autoComplete:"off"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(j.zB,{control:s.control,name:"whiteListAddress",render:e=>{var r=e.field;return(0,l.jsxs)(j.eI,{children:[(0,l.jsx)(j.lR,{children:"白名单"}),(0,l.jsx)(j.MJ,{children:(0,l.jsx)(N.p,(0,t._)({type:"text",placeholder:"不填为不限",className:"!ring-secondary-foreground"},r))}),(0,l.jsx)(j.C5,{})]})}}),(0,l.jsx)(h.$,{type:"submit",disabled:W||X||G||!S||D,className:"mt-4 w-full",children:W?"提交中...":X?"确认中...":G?"已提交":"提交"})]})})),(0,l.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 text-sm mt-4",children:[(0,l.jsx)("p",{className:"mb-1",children:"说明："}),(0,l.jsx)("p",{children:"1. 每个轮次，1个地址最多可以 创建/推举 1 个行动；"}),(0,l.jsx)("p",{children:"2. 创建后，会自动推举该行动；"})]})]}),(0,l.jsx)(R.A,{isLoading:W||X,text:W?"提交交易...":"确认交易..."})]})}},91323:(e,r,s)=>{"use strict";s.d(r,{A:()=>n});var a=s(37876),t=s(30684);let n=e=>{var r=e.type,s=e.message,n=e.className;return(0,a.jsx)("div",{className:(0,t.cn)("p-3 rounded border text-sm",{error:"bg-red-50 border-red-200 text-red-700",warning:"bg-yellow-50 border-yellow-200 text-yellow-700",info:"bg-blue-50 border-blue-200 text-blue-700",success:"bg-green-50 border-green-200 text-green-700"}[void 0===r?"error":r],n),children:s})}},92659:(e,r,s)=>{"use strict";s.d(r,{lV:()=>h,MJ:()=>w,Rr:()=>_,zB:()=>p,eI:()=>y,lR:()=>b,C5:()=>C});var a=s(81110),t=s(40120),n=s(3576),i=s(62701),l=s(65699),d=s(37876),o=s(14232),c=s(82987),m=s(88992),u=s(30684),x=s(59773),f=(0,s(47137).F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),v=o.forwardRef((e,r)=>{var s=e.className,a=(0,l._)(e,["className"]);return(0,d.jsx)(x.b,(0,n._)({ref:r,className:(0,u.cn)(f(),s)},a))});v.displayName=x.b.displayName;var h=m.Op,N=o.createContext({}),p=e=>{var r=(0,a._)({},(0,t._)(e));return(0,d.jsx)(N.Provider,{value:{name:r.name},children:(0,d.jsx)(m.xI,(0,n._)({},r))})},g=()=>{var e=o.useContext(N),r=o.useContext(j),s=(0,m.xW)(),a=s.getFieldState,t=s.formState,i=a(e.name,t);if(!e)throw Error("useFormField should be used within <FormField>");var l=r.id;return(0,n._)({id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message")},i)},j=o.createContext({}),y=o.forwardRef((e,r)=>{var s=e.className,a=(0,l._)(e,["className"]),t=o.useId();return(0,d.jsx)(j.Provider,{value:{id:t},children:(0,d.jsx)("div",(0,n._)({ref:r,className:(0,u.cn)("space-y-2",s)},a))})});y.displayName="FormItem";var b=o.forwardRef((e,r)=>{var s=e.className,a=(0,l._)(e,["className"]),t=g(),i=t.error,o=t.formItemId;return(0,d.jsx)(v,(0,n._)({ref:r,className:(0,u.cn)(i&&"text-destructive",s),htmlFor:o},a))});b.displayName="FormLabel";var w=o.forwardRef((e,r)=>{var s=(0,a._)({},(0,t._)(e)),i=g(),l=i.error,o=i.formItemId,m=i.formDescriptionId,u=i.formMessageId;return(0,d.jsx)(c.DX,(0,n._)({ref:r,id:o,"aria-describedby":l?"".concat(m," ").concat(u):"".concat(m),"aria-invalid":!!l},s))});w.displayName="FormControl";var _=o.forwardRef((e,r)=>{var s=e.className,a=(0,l._)(e,["className"]),t=g().formDescriptionId;return(0,d.jsx)("p",(0,n._)({ref:r,id:t,className:(0,u.cn)("text-sm text-muted-foreground",s)},a))});_.displayName="FormDescription";var C=o.forwardRef((e,r)=>{var s=e.className,a=e.children,t=(0,l._)(e,["className","children"]),o=g(),c=o.error,m=o.formMessageId,x=c?String(null==c?void 0:c.message):a;return x?(0,d.jsx)("p",(0,i._)((0,n._)({ref:r,id:m,className:(0,u.cn)("text-sm font-medium text-destructive",s)},t),{children:x})):null});C.displayName="FormMessage"},94382:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/new",function(){return s(71778)}])}},e=>{e.O(0,[3308,7460,9985,154,3096,4769,6952,4115,636,6593,8792],()=>e(e.s=94382)),_N_E=e.O()}]);