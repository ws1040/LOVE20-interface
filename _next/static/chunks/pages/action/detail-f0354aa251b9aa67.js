try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="e887f1eb-1601-4c9e-91ac-b3ada07c503a",e._sentryDebugIdIdentifier="sentry-dbid-e887f1eb-1601-4c9e-91ac-b3ada07c503a")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2156],{55778:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/detail",function(){return n(48827)}])},35312:function(e,s,n){"use strict";n.d(s,{C:function(){return a}});var t=n(67294),i=n(92180),o=n(93950),r=n(93778),d=n(42130),c=Number("3")/1e3,a=function(){var e=((0,t.useContext)(r.M)||{}).token,s=(0,d.m)().address,n=(0,i.Ty)((null==e?void 0:e.address)||"",s||""),a=n.validGovVotes,u=n.isPending,l=n.error,f=(0,o._H)(null==e?void 0:e.address),v=f.govData,m=f.isPending,x=f.error,g=(0,t.useMemo)(function(){return a&&(null==v?void 0:v.govVotes)&&v.govVotes!==BigInt(0)?Number(a)/Number(v.govVotes):0},[a,null==v?void 0:v.govVotes]);return{hasEnoughVotes:(0,t.useMemo)(function(){return g>=c},[g]),percentage:g,validGovVotes:a,govData:v,SUBMIT_MIN_PERCENTAGE:c,isPending:u||m,error:null!=l?l:x}}},48827:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return I}});var t=n(91309),i=n(85893),o=n(67294),r=n(11163),d=n(83494),c=n(20725),a=n(27245),u=n(86501),l=n(39360),f=n(93566),v=n(73591),m=n(35312),x=n(93778),g=n(17301),b=n(42083),h=n(44576),j=n(91529),N=function(e){var s=e.actionId,n=e.submitted,t=e.onRoundChange,d=((0,o.useContext)(x.M)||{}).token;(0,l.x)();var c=(0,r.useRouter)(),N=(0,f.Bk)(),y=N.currentRound,p=N.isPending,w=N.error;(0,o.useEffect)(function(){t&&"function"==typeof t&&t(y)},[y,t]);var E=(0,m.C)(),I=E.hasEnoughVotes,_=E.percentage,C=E.validGovVotes,B=E.govData,P=E.SUBMIT_MIN_PERCENTAGE,k=E.isPending,T=E.error,V=(0,f.qd)(),R=V.submit,Z=V.isPending,M=V.isConfirming,A=V.isConfirmed,D=V.writeError;(0,o.useEffect)(function(){A&&!D&&(u.Am.success("推举成功",{duration:2e3}),setTimeout(function(){c.push("/vote/?symbol=".concat(null==d?void 0:d.symbol))},2e3))},[A,D]);var S=(0,v.S)().handleContractError;return((0,o.useEffect)(function(){w&&S(w,"submit"),T&&S(T,"submit"),D&&S(D,"submit")},[w,T,D]),k||p)?(0,i.jsx)(b.Z,{}):(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex flex-col m-4",children:[!I&&void 0!==C&&(null==B?void 0:B.govVotes)&&(0,i.jsx)(g.Z,{type:"error",message:"有效治理票，须达到总治理票的".concat((100*P).toFixed(1),"%，才能新建、推举行动（您当前有效治理票为").concat((0,j.LH)(C),"，占比").concat((100*_).toFixed(2),"%）"),className:"mb-4"}),(0,i.jsx)("div",{className:"flex justify-center",children:n||A?(0,i.jsxs)("div",{className:"flex space-x-4 justify-center w-full",children:[(0,i.jsx)(a.z,{disabled:!0,className:"w-1/2",children:"已推举"}),n&&!A&&(0,i.jsx)(a.z,{onClick:function(){return c.push("/vote/?symbol=".concat(null==d?void 0:d.symbol))},className:"w-1/2",children:"去投票"})]}):(0,i.jsxs)(a.z,{onClick:function(){Z||M||!I||R(null==d?void 0:d.address,s)},className:"submit-action-button w-1/2",disabled:Z||M||!I,children:[Z&&"提交中...",M&&"确认中...",!Z&&!M&&"推举本行动"]})}),(0,i.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 text-sm mt-4 w-full",children:[(0,i.jsx)("p",{className:"mb-1",children:"说明："}),(0,i.jsxs)("p",{children:["1. 有效治理票数 ≥ 总治理票的",Number("3")/10,"%，才能推举；"]}),(0,i.jsx)("p",{children:"2. 每轮次，1个地址最多可 创建/推举 1 个行动；"})]})]}),(0,i.jsx)(h.Z,{isLoading:Z||M,text:Z?"提交交易...":"确认交易..."})]})},y=n(42130),p=n(92180),w=n(7080),E=function(e){var s=e.actionId,n=e.onRoundChange,t=(0,y.m)().address,d=((0,o.useContext)(x.M)||{}).token,c=(0,r.useRouter)(),l=(0,w.Bk)(),f=l.currentRound,m=(l.isPending,l.error);(0,o.useEffect)(function(){n&&"function"==typeof n&&n(f)},[f,n]);var g=(0,p.Ty)(null==d?void 0:d.address,t),N=g.validGovVotes,E=g.isPending,I=g.error,_=(0,w.Ol)(null==d?void 0:d.address,f,t,s),C=_.votesNumByAccountByActionId,B=_.isPending,P=_.error,k=(0,w.VI)((null==d?void 0:d.address)||"",f,t||""),T=k.votesNumByAccount,V=k.isPending,R=k.error,Z=E||V||B,M=Z?BigInt(0):N-T,A=(0,w.rv)(),D=A.vote,S=A.isPending,G=A.isConfirming,L=A.isConfirmed,z=A.writeError,H=(0,v.S)().handleContractError;return(0,o.useEffect)(function(){z&&H(z,"vote"),m&&H(m,"vote"),P&&H(P,"vote"),I&&H(I,"stake"),R&&H(R,"vote")},[z,m,P,I,R]),(0,o.useEffect)(function(){L&&!z&&(u.ZP.success("提交成功",{duration:2e3}),setTimeout(function(){c.push("/vote/actions/?symbol=".concat(null==d?void 0:d.symbol))},2e3))},[L,z]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex flex-col items-center space-y-3 p-4 mb-2",children:[(0,i.jsxs)("div",{className:"stats w-full border grid grid-cols-2 divide-x-0 mb-2",children:[(0,i.jsxs)("div",{className:"stat place-items-center",children:[(0,i.jsx)("div",{className:"stat-title",children:"我已投本行动票数"}),(0,i.jsx)("div",{className:"stat-value text-2xl",children:B?(0,i.jsx)(b.Z,{}):(0,j.LH)(C)})]}),(0,i.jsxs)("div",{className:"stat place-items-center",children:[(0,i.jsx)("div",{className:"stat-title",children:"我的剩余票数"}),(0,i.jsx)("div",{className:"stat-value text-2xl",children:Z?(0,i.jsx)(b.Z,{}):(0,j.LH)(M)})]})]}),!B&&M>BigInt(10)?(0,i.jsx)(a.z,{className:"w-1/2",onClick:function(){S||G||D(null==d?void 0:d.address,[s],[M])},disabled:S||G,children:S||G?(0,i.jsx)(b.Z,{}):"将100%票投给此行动"}):(0,i.jsx)(a.z,{className:"w-1/2",disabled:!0,children:Z?(0,i.jsx)(b.Z,{}):"没有剩余票数"}),!E&&(0,i.jsxs)("div",{className:"text-sm text-greyscale-500 text-center",children:["提示: 每轮最大可投票数，等于您的治理票数 (",(0,j.LH)(N),")"]})]}),(0,i.jsx)(h.Z,{isLoading:S||G,text:S?"提交交易...":"确认交易..."})]})},I=function(){var e=(0,r.useRouter)().query,s=e.id,n=e.type,a=e.submitted,u=(0,t._)((0,o.useState)(null),2),l=u[0],f=u[1],v=function(e){f(e)},m=(0,t._)((0,o.useState)(void 0),2),x=(m[0],m[1]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{title:"行动详情",showBackButton:!0}),(0,i.jsxs)("main",{className:"flex-grow",children:["submit"===n&&(0,i.jsx)(N,{actionId:BigInt(s||0),submitted:"true"===a,onRoundChange:v}),"vote"===n&&(0,i.jsx)(E,{actionId:BigInt(s||0),onRoundChange:v}),(0,i.jsx)(c.Z,{actionId:BigInt(s||0),round:BigInt(l||0),showSubmitter:"submit"!==n,onActionInfo:x})]})]})}}},function(e){e.O(0,[8239,367,3494,2252,3950,2180,7724,5370,2888,9774,179],function(){return e(e.s=55778)}),_N_E=e.O()}]);