(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6282],{1709:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var n=t(37876);let r=e=>{var s=e.title;return(0,n.jsx)("div",{className:"flex justify-between items-center",children:(0,n.jsx)("h1",{className:"text-lg font-bold",children:s})})}},18449:(e,s,t)=>{"use strict";t.d(s,{X:()=>i});var n=t(76200);class r extends n.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function i(e,s){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new r({value:e});let[t,n="0"]=e.split("."),i=t.startsWith("-");if(i&&(t=t.slice(1)),n=n.replace(/(0+)$/,""),0===s)1===Math.round(Number(`.${n}`))&&(t=`${BigInt(t)+1n}`),n="";else if(n.length>s){let[e,r,i]=[n.slice(0,s-1),n.slice(s-1,s),n.slice(s)],o=Math.round(Number(`${r}.${i}`));(n=o>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${o}`).length>s&&(n=n.slice(1),t=`${BigInt(t)+1n}`),n=n.slice(0,s)}else n=n.padEnd(s,"0");return BigInt(`${i?"-":""}${t}${n}`)}},70642:(e,s,t)=>{"use strict";t.d(s,{O:()=>a});var n=t(14232),r=t(19591),i=t(44769),o=t(83416),l=t(8047),d=Number(t(99742).env.NEXT_PUBLIC_SUBMIT_MIN_PER_THOUSAND||"0")/1e3,a=()=>{var e=((0,n.useContext)(o.N)||{}).token,s=(0,l.F)().address,t=(0,r.Fd)((null==e?void 0:e.address)||"",s||""),a=t.validGovVotes,c=t.isPending,u=t.error,v=(0,i.W6)(null==e?void 0:e.address),m=v.govData,x=v.isPending,g=v.error,h=(0,n.useMemo)(()=>a&&(null==m?void 0:m.govVotes)&&0n!==m.govVotes?Number(a)/Number(m.govVotes):0,[a,null==m?void 0:m.govVotes]);return{hasEnoughVotes:(0,n.useMemo)(()=>h>=d,[h]),percentage:h,validGovVotes:a,govData:m,SUBMIT_MIN_PERCENTAGE:d,isPending:c||x,error:null!=u?u:g}}},85452:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/action/detail",function(){return t(95034)}])},91323:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var n=t(37876),r=t(30684);let i=e=>{var s=e.type,t=e.message,i=e.className;return(0,n.jsx)("div",{className:(0,r.cn)("p-3 rounded border text-sm",{error:"bg-red-50 border-red-200 text-red-700",warning:"bg-yellow-50 border-yellow-200 text-yellow-700",info:"bg-blue-50 border-blue-200 text-blue-700",success:"bg-green-50 border-green-200 text-green-700"}[void 0===s?"error":s],i),children:t})}},95034:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>A});var n=t(40854),r=t(37876),i=t(14232),o=t(89099),l=t(60154),d=t(92101),a=t(6960),c=t(97685),u=t(1081),v=t(42038),m=t(64115),x=t(4113),g=t(70642),h=t(83416),N=t(91323),b=t(12293),f=t(99574),j=t(20442),p=t(99742);let I=e=>{var s=e.actionId,t=e.submitted,n=e.onRoundChange,l=((0,i.useContext)(h.N)||{}).token,d=(0,u.i)(),I=(0,o.useRouter)(),w=(0,m.vC)(),y=w.currentRound,E=w.isPending,_=w.error;(0,i.useEffect)(()=>{n&&"function"==typeof n&&n(y)},[y,n]);var C=(0,g.O)(),A=C.hasEnoughVotes,B=C.percentage,$=C.validGovVotes,P=C.govData,R=C.SUBMIT_MIN_PERCENTAGE,k=C.isPending,T=C.error,M=(0,m.of)(),V=M.submit,S=M.isPending,F=M.isConfirming,U=M.isConfirmed,O=M.writeError;(0,i.useEffect)(()=>{U&&!O&&(c.oR.success("推举成功",{duration:2e3}),setTimeout(()=>{I.push("/vote/?symbol=".concat(null==l?void 0:l.symbol))},2e3))},[U,O]);var D=(0,x.g)().handleContractError;return((0,i.useEffect)(()=>{_&&D(_,"submit"),T&&D(T,"submit"),O&&D(O,"submit")},[_,T,O]),k||E)?(0,r.jsx)(b.A,{}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex flex-col m-4",children:[!A&&void 0!==$&&(null==P?void 0:P.govVotes)&&(0,r.jsx)(N.A,{type:"error",message:"有效治理票，须达到总治理票的".concat((100*R).toFixed(1),"%，才能新建、推举行动（您当前有效治理票为").concat((0,j.NJ)($),"，占比").concat((100*B).toFixed(2),"%）"),className:"mb-4"}),(0,r.jsx)("div",{className:"flex justify-center",children:t||U?(0,r.jsxs)("div",{className:"flex space-x-4 justify-center w-full",children:[(0,r.jsx)(a.$,{disabled:!0,className:"w-1/2",children:"已推举"}),t&&!U&&(0,r.jsx)(a.$,{onClick:()=>I.push("/vote/?symbol=".concat(null==l?void 0:l.symbol)),className:"w-1/2",children:"去投票"})]}):(0,r.jsxs)(a.$,{onClick:()=>{(0,v.z)(d)&&!S&&!F&&A&&V(null==l?void 0:l.address,s)},className:"w-1/2",disabled:S||F||!A,children:[S&&"提交中...",F&&"确认中...",!S&&!F&&"推举本行动"]})}),(0,r.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 text-sm mt-4 w-full",children:[(0,r.jsx)("p",{className:"mb-1",children:"说明："}),(0,r.jsxs)("p",{children:["1. 有效治理票数 ≥ 总治理票的",Number(p.env.NEXT_PUBLIC_SUBMIT_MIN_PER_THOUSAND)/10,"%，才能推举；"]}),(0,r.jsx)("p",{children:"2. 每轮次，1个地址最多可 创建/推举 1 个行动；"})]})]}),(0,r.jsx)(f.A,{isLoading:S||F,text:S?"提交交易...":"确认交易..."})]})};var w=t(8047),y=t(19591),E=t(98684);let _=e=>{var s=e.actionId,t=e.onRoundChange,n=(0,w.F)().address,l=((0,i.useContext)(h.N)||{}).token,d=(0,o.useRouter)(),u=(0,E.vC)(),v=u.currentRound,m=(u.isPending,u.error);(0,i.useEffect)(()=>{t&&"function"==typeof t&&t(v)},[v,t]);var g=(0,y.Fd)(null==l?void 0:l.address,n),N=g.validGovVotes,p=g.isPending,I=g.error,_=(0,E.$6)(null==l?void 0:l.address,v,n,s),C=_.votesNumByAccountByActionId,A=_.isPending,B=_.error,$=(0,E.Pb)((null==l?void 0:l.address)||"",v,n||""),P=$.votesNumByAccount,R=$.isPending,k=$.error,T=p||R||A,M=T?0n:N-P,V=(0,E.eU)(),S=V.vote,F=V.isPending,U=V.isConfirming,O=V.isConfirmed,D=V.writeError,X=(0,x.g)().handleContractError;return(0,i.useEffect)(()=>{D&&X(D,"vote"),m&&X(m,"vote"),B&&X(B,"vote"),I&&X(I,"stake"),k&&X(k,"vote")},[D,m,B,I,k]),(0,i.useEffect)(()=>{O&&!D&&(c.Ay.success("提交成功",{duration:2e3}),setTimeout(()=>{d.push("/vote/actions/?symbol=".concat(null==l?void 0:l.symbol))},2e3))},[O,D]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-3 p-4 mb-2",children:[(0,r.jsxs)("div",{className:"stats w-full border grid grid-cols-2 divide-x-0 mb-2",children:[(0,r.jsxs)("div",{className:"stat place-items-center",children:[(0,r.jsx)("div",{className:"stat-title",children:"我已投本行动票数"}),(0,r.jsx)("div",{className:"stat-value text-2xl",children:A?(0,r.jsx)(b.A,{}):(0,j.NJ)(C)})]}),(0,r.jsxs)("div",{className:"stat place-items-center",children:[(0,r.jsx)("div",{className:"stat-title",children:"我的剩余票数"}),(0,r.jsx)("div",{className:"stat-value text-2xl",children:T?(0,r.jsx)(b.A,{}):(0,j.NJ)(M)})]})]}),!A&&M>10n?(0,r.jsx)(a.$,{className:"w-1/2",onClick:()=>{F||U||S(null==l?void 0:l.address,[s],[M])},disabled:F||U,children:F||U?(0,r.jsx)(b.A,{}):"将100%票投给此行动"}):(0,r.jsx)(a.$,{className:"w-1/2",disabled:!0,children:T?(0,r.jsx)(b.A,{}):"没有剩余票数"}),!p&&(0,r.jsxs)("div",{className:"text-sm text-greyscale-500 text-center",children:["提示: 每轮最大可投票数，等于您的治理票数 (",(0,j.NJ)(N),")"]})]}),(0,r.jsx)(f.A,{isLoading:F||U,text:F?"提交交易...":"确认交易..."})]})};var C=t(22605);let A=()=>{var e=(0,o.useRouter)().query,s=e.id,t=e.type,a=e.submitted,c=(0,n._)((0,i.useState)(null),2),u=c[0],v=c[1],m=e=>{v(e)},x=(0,n._)((0,i.useState)(void 0),2),g=x[0],h=x[1];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.A,{title:"行动详情",showBackButton:!0}),(0,r.jsxs)("main",{className:"flex-grow",children:["submit"===t&&(0,r.jsx)(I,{actionId:BigInt(s||0),submitted:"true"===a,onRoundChange:m}),"vote"===t&&(0,r.jsx)(_,{actionId:BigInt(s||0),onRoundChange:m}),("join"===t||void 0===t)&&(0,r.jsx)(C.A,{actionId:BigInt(s||0),onRoundChange:m,actionInfo:g}),(0,r.jsx)(d.A,{actionId:BigInt(s||0),round:BigInt(u||0),showSubmitter:"submit"!==t,onActionInfo:h})]})]})}}},e=>{e.O(0,[3308,4243,154,5498,4769,6952,4115,7432,1217,636,6593,8792],()=>e(e.s=85452)),_N_E=e.O()}]);