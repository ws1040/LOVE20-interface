(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2884],{2293:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>I});var t=a(37876),r=a(14232),n=a(8047),l=a(6960),c=a(48230),i=a.n(c),o=a(12293),d=a(83416),x=a(4113),m=a(9215),u=a(44769),N=a(20442),v=a(4066),h=a(99742).env.NEXT_PUBLIC_CONTRACT_ADDRESS_JOIN;let j=e=>{e.currentRound;var s=((0,r.useContext)(d.N)||{}).token,a=(0,m.lW)((null==s?void 0:s.address)||"",h),n=a.balance,l=a.isPending,c=a.error,i=(0,u.bt)((null==s?void 0:s.address)||""),j=i.reward,f=i.isPending,_=i.error,p=(0,x.g)().handleContractError;return(0,r.useEffect)(()=>{c&&p(c,"join"),_&&p(_,"dataViewer")},[c,_]),(0,t.jsx)("div",{className:"px-4",children:(0,t.jsxs)("div",{className:"w-full border rounded-lg p-0",children:[(0,t.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,t.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,t.jsx)("div",{className:"stat-title text-sm pb-1",children:"参与行动代币总数"}),(0,t.jsx)("div",{className:"stat-value text-xl text-secondary",children:l?(0,t.jsx)(o.A,{}):(0,N.NJ)(null!=n?n:0n)})]}),(0,t.jsxs)("div",{className:"stat place-items-center pb-2",children:[(0,t.jsx)("div",{className:"stat-title text-sm pb-1",children:"预计新增铸币"}),(0,t.jsx)("div",{className:"stat-value text-xl text-secondary",children:f?(0,t.jsx)(o.A,{}):(0,N.NJ)(null!=j?j:0n)})]})]}),(0,t.jsxs)("div",{className:"text-center text-xs mb-2 text-greyscale-500",children:["预估年化收益率（APY）：",l||f?(0,t.jsx)(o.A,{}):(0,v.BN)(j,n)]})]})})};var f=a(60154),_=a(91754),p=a(96108),y=a(28638),g=a(62288),b=a(18651),E=a(1709),C=a(87577),A=a(99742);let B=e=>{var s=e.currentRound,a=((0,r.useContext)(d.N)||{}).token,l=(0,n.F)().address,c=(0,u.pX)((null==a?void 0:a.address)||"",s||0n,l),m=c.joinableActions,h=c.isPending,j=c.error,f=(0,g.CZ)((null==a?void 0:a.address)||""),B=f.rewardAvailable,w=f.isPending,T=f.error,I=(null==m?void 0:m.reduce((e,s)=>e+s.votesNum,0n))||0n,P=a?s-BigInt(a.initialStakeRound)+1n:0n,R=(0,v.u3)(B,P),L=(0,x.g)().handleContractError;return(0,r.useEffect)(()=>{j&&L(j,"dataViewer"),T&&L(T,"mint")},[j,T]),(0,t.jsxs)("div",{className:"px-4 py-6",children:[(0,t.jsx)(E.A,{title:"本轮可参与的行动："}),(0,t.jsx)(b.A,{currentRound:s,roundType:"act"}),!l&&(0,t.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"请先连接钱包"}),l&&h&&(0,t.jsx)("div",{className:"p-4 flex justify-center items-center",children:(0,t.jsx)(o.A,{})}),l&&!h&&!(null==m?void 0:m.length)&&(0,t.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"本轮暂无行动"}),!h&&m&&m.length>0&&(0,t.jsxs)("div",{className:"mt-2 space-y-4",children:[null==m?void 0:m.sort((e,s)=>{var a=Number(e.votesNum);return Number(s.votesNum)-a}).map((e,s)=>{var r=e.joinedAmountOfAccount>0n,n=Number(I)>0?Number(m[s].votesNum||0n)/Number(I):0,l=r?"/action/detail?id=".concat(e.action.head.id,"&type=join&symbol=").concat(null==a?void 0:a.symbol):"/acting/join?id=".concat(e.action.head.id,"&symbol=").concat(null==a?void 0:a.symbol);return(0,t.jsx)(y.Zp,{className:"shadow-none",children:(0,t.jsxs)(i(),{href:l,className:"relative block",children:[(0,t.jsxs)(y.aR,{className:"px-3 pt-2 pb-1 flex-row justify-between items-baseline",children:[(0,t.jsxs)("div",{className:"flex items-baseline",children:[(0,t.jsx)("span",{className:"text-greyscale-400 text-sm",children:"No."}),(0,t.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.head.id)}),(0,t.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.body.title)})]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 text-xs mr-1",children:"投票占"}),(0,t.jsx)("span",{className:"text-secondary text-xs",children:(0,N.Ee)(100*n)})]})]}),(0,t.jsx)(y.Wu,{className:"px-3 pt-1 pb-2",children:(0,t.jsxs)("div",{className:"flex justify-between mt-1 text-sm",children:[(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(_.A,{className:"text-greyscale-400 mr-1 h-3 w-3 -translate-y-0.5"}),(0,t.jsx)("span",{className:"text-greyscale-400",children:(0,t.jsx)(C.A,{address:m[s].action.head.author,showCopyButton:!1,colorClassName2:"text-secondary"})})]}),e.hasReward?(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-greyscale-400 text-xs mr-1",children:"预估年化(APY)"}),(0,t.jsx)("span",{className:"text-secondary text-xs",children:w?(0,t.jsx)(o.A,{}):(0,v.BN)(BigInt(Math.floor(Number(R||0n)*n)),m[s].joinedAmount)})]}):(0,t.jsx)("span",{className:"flex justify-between text-error text-sm",children:"无铸币奖励"})]})}),(0,t.jsx)(p.A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-greyscale-400 pointer-events-none"})]})},e.action.head.id)}),(0,t.jsxs)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:[(0,t.jsx)("span",{className:"text-red-500 font-bold",children:"提醒："}),(0,t.jsxs)("span",{children:["每个行动阶段，最后",A.env.NEXT_PUBLIC_JOIN_END_PHASE_BLOCKS,"个区块（约",(0,N.Xo)(Number(A.env.NEXT_PUBLIC_JOIN_END_PHASE_BLOCKS)*Number(A.env.NEXT_PUBLIC_BLOCK_TIME)/100),"），无法参与行动报名"]})]})]})]})};var w=a(62537),T=a(17660);let I=()=>{var e=(0,n.F)().isConnected,s=((0,r.useContext)(d.N)||{}).token,a=e&&(null==s?void 0:s.hasEnded)===!0,c=(0,T.vC)(a),m=c.currentRound,u=c.error,N=c.isPending,v=(0,x.g)().handleContractError;return((0,r.useEffect)(()=>{u&&v(u,"join")},[u]),a&&N)?(0,t.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,t.jsx)(o.A,{})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.A,{title:"社区首页"}),(0,t.jsx)("main",{className:"flex-grow",children:e?s?s&&!s.hasEnded?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.A,{}),(0,t.jsxs)("div",{className:"flex flex-col items-center p-4 mt-4",children:[(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"公平发射未结束，还不能参与社区行动"}),(0,t.jsx)(l.$,{className:"w-1/2",asChild:!0,children:(0,t.jsx)(i(),{href:"/launch?symbol=".concat(s.symbol),children:"查看公平发射"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.A,{}),(0,t.jsx)(j,{currentRound:m}),(0,t.jsx)(B,{currentRound:m})]}):(0,t.jsx)(o.A,{}):(0,t.jsx)("div",{className:"flex flex-col items-center p-4 mt-4",children:(0,t.jsx)("div",{className:"text-center mb-4 text-greyscale-500",children:"没有链接钱包，请先连接钱包"})})})]})}},4066:(e,s,a)=>{"use strict";a.d(s,{BN:()=>c,bD:()=>l,u$:()=>i,u3:()=>o});var t=a(20442),r=a(65575),n=a(99742),l=(e,s,a)=>{if(!e||!s)return"0%";var l=31536e5/Number(n.env.NEXT_PUBLIC_BLOCK_TIME||0),c=(0,r.oQ)(n.env.NEXT_PUBLIC_PHASE_BLOCKS||"0");if(0===l||0n===c)return console.error("配置错误: NEXT_PUBLIC_BLOCK_TIME 或 NEXT_PUBLIC_PHASE_BLOCKS 未设置"),"0%";var i=e?99n*e*99n/2000000n:BigInt(0),o=(2n*s||BigInt(0))+(a||BigInt(0));if(o===BigInt(0))return"0%";var d=Number(i)/Number(o)/(Number(c)/l)*100;return(0,t.Ee)(d)},c=(e,s)=>{if(!e||!s||0n===s)return"∞";var a=31536e5/Number(n.env.NEXT_PUBLIC_BLOCK_TIME||0),l=(0,r.oQ)(n.env.NEXT_PUBLIC_PHASE_BLOCKS||"0");if(0===a||0n===l)return console.error("配置错误: BLOCK_TIME 或 PHASE_BLOCKS 未设置或为0"),"0%";var c=Number(e)/Number(s)/(Number(l)/a)*100;return(0,t.Ee)(c)},i=function(e){var s,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=Number(n.env.NEXT_PUBLIC_PHASE_BLOCKS)||0,r=Number(n.env.NEXT_PUBLIC_BLOCK_TIME)||0,l=e*t,c=Math.ceil(l*r/100);if(c>=86400){var i=Math.ceil(c/86400);s="".concat(i,"天")}else if(c>=3600){var o=Math.ceil(c/3600);s="".concat(o,"小时")}else{var d=Math.ceil(c/60);s="".concat(d,"分钟")}var x="".concat(l.toLocaleString(),"区块，约").concat(s);return a||(x="".concat(e,"个阶段（").concat(x,")")),x},o=(e,s)=>{if(!e)return BigInt(0);var a=1000n-(0,r.oQ)(n.env.NEXT_PUBLIC_ROUND_REWARD_GOV_PER_THOUSAND||"5")-(0,r.oQ)(n.env.NEXT_PUBLIC_ROUND_REWARD_ACTION_PER_THOUSAND||"5"),t=BigInt(0);return s<=1n?e*(0,r.oQ)(n.env.NEXT_PUBLIC_ROUND_REWARD_ACTION_PER_THOUSAND||"0")/1000n:e*a*(0,r.oQ)(n.env.NEXT_PUBLIC_ROUND_REWARD_ACTION_PER_THOUSAND||"0")/1000000n}},18651:(e,s,a)=>{"use strict";a.d(s,{A:()=>x});var t=a(40854),r=a(37876),n=a(14232),l=a(63934),c=a(83416);let i=e=>{var s=e.initialTimeLeft,a=e.onTick,l=(0,t._)((0,n.useState)(Date.now()+1e3*s),2),c=l[0],i=l[1],o=(0,t._)((0,n.useState)(s),2),d=o[0],x=o[1];(0,n.useEffect)(()=>{i(Date.now()+1e3*s)},[s]),(0,n.useEffect)(()=>{var e=setInterval(()=>{var s=Math.max(0,Math.floor((c-Date.now())/1e3));x(s),a&&a(s),s<=0&&(clearInterval(e),window.location.reload())},1e3);return()=>clearInterval(e)},[c,a]);var m=Math.floor(d/86400),u=Math.floor(d%86400/3600),N=Math.floor(d%3600/60);return(0,r.jsxs)("div",{className:"inline-flex gap-1 text-greyscale-400",children:[m>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"countdown font-mono",children:(0,r.jsx)("span",{style:{"--value":m}})}),"天"]}),(u>0||m>0)&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"countdown font-mono",children:(0,r.jsx)("span",{style:{"--value":u}})}),"时"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"countdown font-mono",children:(0,r.jsx)("span",{style:{"--value":N}})}),"分"]}),m<=0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"countdown font-mono",children:(0,r.jsx)("span",{style:{"--value":d%60}})}),"秒"]})]})};var o=a(12293),d=a(99742);let x=e=>{var s=e.currentRound,a=e.roundType,x=e.showCountdown,m=(0,l.y)().data,u=(0,n.useContext)(c.N),N=u?u.token:void 0,v=!m||!N||void 0===N.voteOriginBlocks,h=(0,t._)((0,n.useState)(0n),2),j=h[0],f=h[1],_=Number(d.env.NEXT_PUBLIC_PHASE_BLOCKS)||0,p=Number(d.env.NEXT_PUBLIC_BLOCK_TIME)||0,y=N?Number(N.voteOriginBlocks):0,g=_-(Number(m)-y)%_,b=g>0?Math.ceil(g*p/100):0,E=(0,t._)((0,n.useState)(b),2),C=E[0],A=E[1];(0,n.useEffect)(()=>{if(m){var e=_-(Number(m)-y)%_;A(e>0?Math.ceil(e*p/100):0)}},[m,_,p,y]),(0,n.useEffect)(()=>{s>0n&&f(s)},[s]);var B=null!=j?j.toString():"0";return j<=0n?(0,r.jsx)(r.Fragment,{}):v||null==j||j<0n?((null==j||j<0n)&&(console.log("currentTokenRound",j),console.log("currentRound",s)),(0,r.jsx)(o.A,{})):(0,r.jsx)("div",{className:"flex items-center mb-3",children:(0,r.jsxs)("span",{className:"text-sm text-greyscale-400",children:["( 第",(0,r.jsx)("span",{className:"text-greyscale-400",children:B}),"轮","vote"===a?"投票":"verify"===a?"验证":"行动","阶段，",(0,r.jsx)("span",{className:"text-greyscale-400",children:"剩余"}),(0,r.jsx)("span",{className:"text-greyscale-400",children:Math.ceil(100*C/p)}),(0,r.jsx)("span",{className:"text-greyscale-400 mr-1",children:"块, 约"}),void 0===x||x?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(i,{initialTimeLeft:b,onTick:A})}):(0,r.jsx)("span",{className:"text-greyscale-400",children:C<60?"".concat(C,"秒"):C<=300?"".concat(Math.floor(C/60),"分钟").concat(C%60,"秒"):C<3600?"".concat(Math.floor(C/60),"分钟"):"".concat(Math.floor(C/3600),"小时").concat(Math.floor(C%3600/60),"分钟")}),(0,r.jsx)("span",{className:"text-greyscale-400",children:" )"})]})})}},28638:(e,s,a)=>{"use strict";a.d(s,{BT:()=>x,Wu:()=>m,ZB:()=>d,Zp:()=>i,aR:()=>o,wL:()=>u});var t=a(3576),r=a(65699),n=a(37876),l=a(14232),c=a(30684),i=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a)},l))});i.displayName="Card";var o=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",a)},l))});o.displayName="CardHeader";var d=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("text-2xl font-semibold leading-none tracking-tight",a)},l))});d.displayName="CardTitle";var x=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("text-sm text-muted-foreground",a)},l))});x.displayName="CardDescription";var m=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("p-6 pt-0",a)},l))});m.displayName="CardContent";var u=l.forwardRef((e,s)=>{var a=e.className,l=(0,r._)(e,["className"]);return(0,n.jsx)("div",(0,t._)({ref:s,className:(0,c.cn)("flex items-center p-6 pt-0",a)},l))});u.displayName="CardFooter"},45839:(e,s,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/acting",function(){return a(2293)}])},75695:(e,s,a)=>{"use strict";a.d(s,{A:()=>u});var t=a(16927),r=a(40854),n=a(4902),l=a(37876),c=a(14232),i=a(7446),o=a(95167),d=a(8047),x=a(44571),m=a(97685);function u(e){var s=e.tokenAddress,a=e.tokenSymbol,u=e.tokenDecimals,N=e.tokenImage,v=(0,r._)((0,c.useState)(!1),2),h=v[0],j=v[1],f=(0,d.F)().isConnected,_=(0,x.G)().data;return a.length>11?null:(0,l.jsx)("button",{onClick:()=>(0,t._)(function(){return(0,n.YH)(this,function(e){switch(e.label){case 0:if(!f)return alert("请先连接你的钱包"),[2];j(!0),e.label=1;case 1:if(e.trys.push([1,3,4,5]),!_)return alert("无法获取钱包客户端"),[2];return[4,_.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:s,symbol:a,decimals:u,image:N}}})];case 2:return e.sent()?m.Ay.success("代币已成功添加到 MetaMask 钱包"):m.Ay.error("用户拒绝添加代币"),[3,5];case 3:return console.error("添加代币失败:",e.sent()),m.Ay.error("添加代币失败，请检查控制台以获取更多信息"),[3,5];case 4:return j(!1),[7];case 5:return[2]}})})(),disabled:h,className:"flex items-center justify-center p-1 rounded hover:bg-gray-200 focus:outline-none",children:h?(0,l.jsx)(i.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(o.A,{className:"h-4 w-4 text-greyscale-500"})})}},91754:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var t=(0,a(11713).A)("UserPen",[["path",{d:"M11.5 15H7a4 4 0 0 0-4 4v2",key:"15lzij"}],["path",{d:"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1817ys"}],["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}]])}},e=>{e.O(0,[3308,4243,4571,5701,5060,154,5498,4769,5139,2288,7432,2537,636,6593,8792],()=>e(e.s=45839)),_N_E=e.O()}]);