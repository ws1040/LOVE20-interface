try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3948b0b2-7862-4d01-a1c9-2330323b9bde",e._sentryDebugIdIdentifier="sentry-dbid-3948b0b2-7862-4d01-a1c9-2330323b9bde")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{51436:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actionrewards",function(){return t(69534)}])},64777:function(e,n,t){"use strict";var r=t(85893);n.Z=function(e){var n=e.title;return(0,r.jsx)("div",{className:"flex justify-between items-center",children:(0,r.jsx)("h1",{className:"text-lg font-bold",children:n})})}},42083:function(e,n,t){"use strict";var r=t(85893),s=t(23432);n.Z=function(){return(0,r.jsx)(s.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},69534:function(e,n,t){"use strict";t.r(n);var r=t(11010),s=t(72253),i=t(14932),a=t(91309),d=t(97582),c=t(85893),o=t(67294),l=t(86501),u=t(42130),f=t(11163),h=t(93778),x=t(7208),g=t(93950),m=t(7399),b=t(73591),v=t(83494),y=t(64777),w=t(42083),j=t(44576),p=t(27245),N=t(91529),I=t(6743),_=BigInt(30);n.default=function(){var e,n=(0,f.useRouter)(),t=((0,o.useContext)(h.M)||{}).token,S=(0,u.m)().address,B=(0,x.N6)(null==t?void 0:t.address,S,_),E=B.rewards,M=B.isPending,$=B.error,k=(0,o.useMemo)(function(){if(!E)return[];var e=new Set;return E.forEach(function(n){return e.add(n.actionId)}),Array.from(e)},[E]),Z=(0,g.fT)(null==t?void 0:t.address,k),C=Z.actionInfos,P=Z.isPending,T=Z.error,D=(0,o.useMemo)(function(){if(!C||!E)return[];var e=new Map,n=!0,t=!1,r=void 0;try{for(var s,i=E[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var a=s.value;if(!(a.reward<=BigInt(0))){var d=a.actionId.toString();e.has(d)||e.set(d,[]),e.get(d).push(a)}}}catch(e){t=!0,r=e}finally{try{n||null==i.return||i.return()}finally{if(t)throw r}}var c=[],o=!0,l=!1,u=void 0;try{for(var f,h=C[Symbol.iterator]();!(o=(f=h.next()).done);o=!0){var x=f.value,g=String(x.head.id),m=e.get(g)||[];m.length>0&&m.sort(function(e,n){return e.round>n.round?-1:1}),c.push({action:x,rewards:m})}}catch(e){l=!0,u=e}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}return c.sort(function(e,n){return BigInt(e.action.head.id)>BigInt(n.action.head.id)?-1:1}),c},[C,E]),F=(0,m.Rb)(),O=F.mintActionReward,R=F.isPending,z=F.isConfirming,A=F.isConfirmed,L=F.writeError,V=(0,a._)((0,o.useState)(null),2),X=V[0],H=V[1],J=(0,a._)((0,o.useState)(new Set),2),K=J[0],W=J[1];(0,o.useEffect)(function(){if(A){if(l.ZP.success("铸造成功"),X){var e="".concat(X.actionId.toString(),"-").concat(X.round.toString());W(function(n){var t=new Set(n);return t.add(e),t})}(null==t?void 0:t.address)&&S&&(0,I.j)(S,t.address,!1)}},[A,X,null==t?void 0:t.address,S]),(0,o.useEffect)(function(){W(new Set)},[null==t?void 0:t.address,S]),(0,o.useEffect)(function(){if((null==t?void 0:t.address)&&S&&!M&&E&&!E.some(function(e){return e.reward>BigInt(0)&&!e.isMinted})){var e=(0,I.FP)(S,t.address);if(null==e?void 0:e.needMinted){var n=(0,I.iO)(S,t.address);localStorage.removeItem(n),(0,I.j)(S,t.address,!1)}}},[null==t?void 0:t.address,S,M,E]);var q=(e=(0,r._)(function(e,n){return(0,d.Jh)(this,function(r){switch(r.label){case 0:if(!((null==t?void 0:t.address)&&S))return[3,2];return H({actionId:n,round:e}),[4,O(t.address,e,n)];case 1:r.sent(),r.label=2;case 2:return[2]}})}),function(n,t){return e.apply(this,arguments)}),G=(0,o.useMemo)(function(){return D?D.map(function(e){return(0,i._)((0,s._)({},e),{rewards:e.rewards.map(function(n){var t="".concat(BigInt(e.action.head.id).toString(),"-").concat(n.round.toString());return K.has(t)||n.isMinted?(0,i._)((0,s._)({},n),{isMinted:!0}):n})})}):[]},[D,K]),Q=(0,b.S)().handleContractError;return(0,o.useEffect)(function(){$&&Q($,"dataViewer"),T&&Q(T,"dataViewer"),L&&Q(L,"mint")},[$,T,L,Q]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(v.Z,{title:"行动激励",showBackButton:!0}),(0,c.jsxs)("main",{className:"flex-grow",children:[t?(0,c.jsxs)("div",{className:"flex flex-col space-y-6 p-4",children:[(0,c.jsx)(y.Z,{title:"铸造行动激励"}),M||P?(0,c.jsx)(w.Z,{}):G.length>0?G.map(function(e){return(0,c.jsxs)("div",{className:"border border-gray-100 rounded-lg p-4 shadow-sm",children:[(0,c.jsx)("div",{className:"flex items-center mb-3",children:(0,c.jsxs)("div",{className:"flex items-baseline  mr-2",children:[(0,c.jsx)("span",{className:"text-greyscale-500",children:"No."}),(0,c.jsx)("span",{className:"text-secondary text-xl font-bold mr-2",children:String(e.action.head.id)}),(0,c.jsx)("span",{className:"font-bold text-greyscale-800",children:"".concat(e.action.body.title)})]})}),e.rewards.length>0?(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("table",{className:"table w-full table-auto",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,c.jsx)("th",{children:"轮次"}),(0,c.jsx)("th",{className:"text-center",children:"可铸造激励"}),(0,c.jsx)("th",{className:"text-center",children:"结果"})]})}),(0,c.jsx)("tbody",{children:e.rewards.map(function(n,r){return(0,c.jsxs)("tr",{className:r===e.rewards.length-1?"border-none":"border-b border-gray-100",children:[(0,c.jsx)("td",{children:(0,N.cK)(n.round,t).toString()}),(0,c.jsx)("td",{className:"text-center",children:(0,N.LH)(n.reward||BigInt(0))}),(0,c.jsx)("td",{className:"text-center",children:n.reward>BigInt(0)&&!n.isMinted?(0,c.jsx)(p.z,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:function(){return q(n.round,BigInt(e.action.head.id))},disabled:R||z,children:"铸造"}):n.isMinted?(0,c.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):(0,c.jsx)("span",{className:"text-greyscale-500",children:"-"})})]},"".concat(e.action.head.id,"-").concat(n.round.toString()))})})]})}):(0,c.jsxs)("div",{className:"text-center text-greyscale-500 py-4",children:["该行动最近 ",_.toString()," 轮没有获得激励"]}),(0,c.jsx)("div",{className:"text-center",children:(0,c.jsx)("button",{onClick:function(){return n.push("/my/rewardsofaction?id=".concat(e.action.head.id))},className:"text-secondary hover:text-secondary/80 underline text-sm bg-transparent border-none cursor-pointer",children:"查看更多激励 >>"})})]},e.action.head.id)}):(0,c.jsxs)("div",{className:"text-center text-greyscale-500 py-8",children:["最近 ",_.toString()," 轮没有获得激励"]})]}):(0,c.jsx)(w.Z,{}),(0,c.jsx)(j.Z,{isLoading:R||z,text:R?"提交交易...":"确认交易..."})]})]})}},21803:function(e,n,t){"use strict";function r(e,n){let[t,r="0"]=e.split("."),s=t.startsWith("-");if(s&&(t=t.slice(1)),r=r.replace(/(0+)$/,""),0===n)1===Math.round(Number(`.${r}`))&&(t=`${BigInt(t)+1n}`),r="";else if(r.length>n){let[e,s,i]=[r.slice(0,n-1),r.slice(n-1,n),r.slice(n)],a=Math.round(Number(`${s}.${i}`));(r=a>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${a}`).length>n&&(r=r.slice(1),t=`${BigInt(t)+1n}`),r=r.slice(0,n)}else r=r.padEnd(n,"0");return BigInt(`${s?"-":""}${t}${r}`)}t.d(n,{v:function(){return r}})}},function(e){e.O(0,[8239,367,3494,2252,3950,7399,2888,9774,179],function(){return e(e.s=51436)}),_N_E=e.O()}]);