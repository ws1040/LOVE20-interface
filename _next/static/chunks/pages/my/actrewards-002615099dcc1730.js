(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4249],{1709:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});var t=r(37876);let a=e=>{var s=e.title;return(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsx)("h1",{className:"text-lg font-bold",children:s})})}},11704:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/my/actrewards",function(){return r(79441)}])},19671:(e,s,r)=>{"use strict";r.d(s,{BE:()=>N,I6:()=>g,Uz:()=>x,_s:()=>o,cp:()=>m,gk:()=>f,tb:()=>v,zj:()=>j});var t=r(3576),a=r(62701),n=r(65699),c=r(37876),l=r(14232),i=r(28653),d=r(30684),o=e=>{var s=e.shouldScaleBackground,r=(0,n._)(e,["shouldScaleBackground"]);return(0,c.jsx)(i._s.Root,(0,t._)({shouldScaleBackground:void 0===s||s},r))};o.displayName="Drawer";var x=i._s.Trigger,u=i._s.Portal,m=i._s.Close,h=l.forwardRef((e,s)=>{var r=e.className,a=(0,n._)(e,["className"]);return(0,c.jsx)(i._s.Overlay,(0,t._)({ref:s,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",r)},a))});h.displayName=i._s.Overlay.displayName;var j=l.forwardRef((e,s)=>{var r=e.className,l=e.children,o=(0,n._)(e,["className","children"]);return(0,c.jsxs)(u,{children:[(0,c.jsx)(h,{}),(0,c.jsxs)(i._s.Content,(0,a._)((0,t._)({ref:s,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",r)},o),{children:[(0,c.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),l]}))]})});j.displayName="DrawerContent";var N=e=>{var s=e.className,r=(0,n._)(e,["className"]);return(0,c.jsx)("div",(0,t._)({className:(0,d.cn)("grid gap-1.5 p-4 text-center sm:text-left",s)},r))};N.displayName="DrawerHeader";var v=e=>{var s=e.className,r=(0,n._)(e,["className"]);return(0,c.jsx)("div",(0,t._)({className:(0,d.cn)("mt-auto flex flex-col gap-2 p-4",s)},r))};v.displayName="DrawerFooter";var f=l.forwardRef((e,s)=>{var r=e.className,a=(0,n._)(e,["className"]);return(0,c.jsx)(i._s.Title,(0,t._)({ref:s,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",r)},a))});f.displayName=i._s.Title.displayName;var g=l.forwardRef((e,s)=>{var r=e.className,a=(0,n._)(e,["className"]);return(0,c.jsx)(i._s.Description,(0,t._)({ref:s,className:(0,d.cn)("text-sm text-muted-foreground",r)},a))});g.displayName=i._s.Description.displayName},42038:(e,s,r)=>{"use strict";r.d(s,{z:()=>c});var t=r(97685),a=r(99090),n=r(99742),c=e=>{var s,r=(()=>{var e,s,r=null==(s=a.$.chains)||null==(e=s[0])?void 0:e.id;if("number"==typeof r)return r;var t=Number(n.env.NEXT_PUBLIC_CHAIN_ID);return Number.isFinite(t)?t:void 0})();return!!e&&!!r&&e===r||(t.oR.error("请先将钱包链接 ".concat(null!=(s=n.env.NEXT_PUBLIC_CHAIN_NAME)?s:n.env.NEXT_PUBLIC_CHAIN)),!1)}},79441:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>T});var t=r(40854),a=r(37876),n=r(14232),c=r(89099),l=r(17660),i=r(4113),d=r(92101),o=r(60154),x=r(12293),u=r(16927),m=r(3576),h=r(62701),j=r(4902),N=r(8047),v=r(1081),f=r(6960),g=r(30822),p=r(96108),_=r(97685),y=r(62288),b=r(44769),w=r(83416),C=r(87577),I=r(19671);let A=e=>{var s=e.currentRound,r=e.handleChangedRound,c=(0,t._)((0,n.useState)(!1),2),l=c[0],i=c[1],d=e=>{r(e),i(!1)},o=(0,n.useRef)(null),x=(0,n.useRef)(!1);return(0,a.jsxs)(I._s,{open:l,onOpenChange:i,children:[(0,a.jsx)(I.Uz,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"link",className:"text-secondary no-underline pl-2 pr-1",children:"切换轮次"})}),(0,a.jsxs)(I.zj,{className:"z-[9999] min-h-[25vh]",children:[(0,a.jsxs)(I.BE,{children:[(0,a.jsx)(I.gk,{}),(0,a.jsx)(I.I6,{})]}),(0,a.jsx)("div",{className:"px-4 flex-grow",children:(0,a.jsx)("div",{className:"max-h-64 overflow-y-auto",children:Array.from({length:Number(s)},(e,r)=>{var t=Number(s)-r;return(0,a.jsx)(f.$,{variant:"ghost",className:"w-full p-2 text-center rounded-none hover:bg-gray-100 touch-manipulation",onPointerDown:e=>{"touch"===e.pointerType?o.current=e.clientY:o.current=null,x.current=!1},onPointerMove:e=>{"touch"===e.pointerType&&null!==o.current&&Math.abs(e.clientY-o.current)>10&&(x.current=!0)},onPointerUp:e=>{"touch"===e.pointerType?(x.current||d(t),o.current=null,x.current=!1):d(t)},style:{touchAction:"manipulation"},children:(0,a.jsxs)("span",{className:"text-lg",children:["第 ",t," 轮"]})},t)})})}),(0,a.jsx)(I.tb,{children:(0,a.jsx)(I.cp,{asChild:!0,children:(0,a.jsx)(f.$,{variant:"outline",children:"关闭"})})})]})]})};var E=r(1709),R=r(99574),k=r(42038),B=r(20442),S=r(43885);let P=e=>{var s=e.currentJoinRound,r=e.actionId,c=e.actionInfo,l=((0,n.useContext)(w.N)||{}).token,d=(0,N.F)().address,o=(0,v.i)(),I=(0,t._)((0,n.useState)(0n),2),P=I[0],z=I[1],T=(0,t._)((0,n.useState)(new Set),2),$=T[0],D=T[1];(0,n.useEffect)(()=>{l&&s-BigInt(l.initialStakeRound)>=2n&&z(s-2n)},[s,l]);var F=(0,b.p$)(null==l?void 0:l.address,l&&P?P:0n,r),H=F.verifiedAddresses,M=F.isPending,U=F.error,L=(0,b.Zp)(null==l?void 0:l.address,l&&P?P:0n,r),O=L.verificationInfos,X=L.isPending,V=L.error,Y=(0,t._)((0,n.useState)([]),2),J=Y[0],q=Y[1];(0,n.useEffect)(()=>{H&&q(H)},[H]);var K=(0,y.b$)(),Z=K.mintActionReward,G=K.isPending,Q=K.isConfirming,W=K.isConfirmed,ee=K.writeError;(0,n.useEffect)(()=>{W&&(q(e=>e.map(e=>e.account===d?(0,h._)((0,m._)({},e),{isMinted:!0}):e)),_.Ay.success("铸造成功"))},[W,d]);var es=(0,i.g)().handleContractError;(0,n.useEffect)(()=>{U&&es(U,"dataViewer"),V&&es(V,"dataViewer"),ee&&es(ee,"mint")},[U,V,ee]),(0,n.useEffect)(()=>{J.length>0&&0===$.size&&D(new Set([[...J].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score))[0].account]))},[J]);var er=[...J].sort((e,s)=>e.score>s.score?-1:+(e.score<s.score));return(0,a.jsxs)("div",{className:"relative px-4 py-4",children:[0n===P&&(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-500",children:"暂无验证结果"})}),(0,a.jsx)("div",{className:"flex items-center",children:P>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.A,{title:"验证结果"}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-2",children:"("}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:"行动轮第"}),(0,a.jsx)("span",{className:"text-sm text-secondary ml-1",children:P.toString()}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500 ml-1",children:"轮"}),(0,a.jsx)(A,{currentRound:l&&s?(0,B.LP)(s-2n,l):0n,handleChangedRound:e=>{z(BigInt(e))}}),(0,a.jsx)("span",{className:"text-sm text-greyscale-500",children:")"})]})}),M||X?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(x.A,{})}):0===J.length?P>0n&&(0,a.jsx)("div",{className:"text-center text-sm text-greyscale-400 p-4",children:"没有可铸造激励的地址"}):(0,a.jsxs)("table",{className:"table w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{}),(0,a.jsx)("th",{children:"被抽中地址"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"获得验证票"}),(0,a.jsx)("th",{className:"px-1 text-right",children:"可铸造激励"}),(0,a.jsx)("th",{className:"text-right"})]})}),(0,a.jsx)("tbody",{children:er.map(e=>{var s=null==O?void 0:O.find(s=>s.account===e.account),t=$.has(e.account);return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("tr",{className:"border-b border-gray-100 ".concat(e.account===d?"text-secondary":""),children:[(0,a.jsx)("td",{className:"px-1 w-8",children:s&&(0,a.jsx)("button",{onClick:()=>(e=>{var s=new Set($);s.has(e)?s.delete(e):s.add(e),D(s)})(e.account),className:"text-greyscale-400 hover:text-greyscale-600",children:t?(0,a.jsx)(g.A,{size:16}):(0,a.jsx)(p.A,{size:16})})}),(0,a.jsx)("td",{className:"px-1 ",children:(0,a.jsx)(C.A,{address:e.account,showCopyButton:!0,word:e.account===d?"(我)":""})}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,B.$w)(e.score)}),(0,a.jsx)("td",{className:"px-1 text-right",children:(0,B.$w)(e.reward||0n)}),(0,a.jsx)("td",{className:"px-1 text-right",children:e.account===d&&(e.reward>0n&&!e.isMinted?(0,a.jsx)(f.$,{variant:"outline",size:"sm",className:"text-secondary border-secondary",onClick:()=>(e=>(0,u._)(function(){return(0,j.YH)(this,function(s){switch(s.label){case 0:if(!(0,k.z)(o))return[2];if(!(d&&e.reward>0n&&!e.isMinted&&l))return[3,2];return[4,Z(null==l?void 0:l.address,P,r)];case 1:s.sent(),s.label=2;case 2:return[2]}})})())(e),disabled:G||Q,children:"铸造"}):e.score>0?(0,a.jsx)("span",{className:"text-greyscale-500",children:"已铸造"}):null)})]}),s&&c&&t&&(0,a.jsxs)("tr",{className:"border-b border-gray-100 bg-gray-50",children:[(0,a.jsx)("td",{}),(0,a.jsx)("td",{colSpan:4,className:"px-1 py-3",children:(0,a.jsxs)("div",{className:"text-sm text-greyscale-600",children:[(0,a.jsx)("div",{className:"text-xs text-greyscale-400 mb-2",children:"验证信息:"}),c.body.verificationKeys.map((e,r)=>(0,a.jsxs)("div",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"text-greyscale-500",children:[e,":"]})," ",(0,a.jsx)(S.H,{text:s.infos[r]})]},r))]})})]})]},e.account)})})]}),(0,a.jsx)(R.A,{isLoading:G||Q,text:G?"提交交易...":"确认交易..."})]})};var z=r(22605);let T=()=>{var e=(0,c.useRouter)().query.id,s=(0,l.vC)(),r=s.currentRound,u=s.isPending,m=s.error,h=(0,t._)((0,n.useState)(void 0),2),j=h[0],N=h[1],v=(0,i.g)().handleContractError;return(0,n.useEffect)(()=>{m&&v(m,"join")},[m]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{title:"行动激励",showBackButton:!0}),(0,a.jsx)("main",{className:"flex-grow",children:u?(0,a.jsx)(x.A,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z.A,{actionId:BigInt(e||0),onRoundChange:()=>{},actionInfo:j}),(0,a.jsx)(P,{currentJoinRound:r,actionId:BigInt(e||0),actionInfo:j}),(0,a.jsx)(d.A,{actionId:BigInt(e||0),round:r,showSubmitter:!1,showVerifyHistory:!1,onActionInfo:N})]})})]})}}},e=>{e.O(0,[3308,4243,5701,154,5498,4769,4115,2288,7432,1217,636,6593,8792],()=>e(e.s=11704)),_N_E=e.O()}]);