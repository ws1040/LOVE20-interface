try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f0670546-26a1-4496-82e9-04c1b626c333",e._sentryDebugIdIdentifier="sentry-dbid-f0670546-26a1-4496-82e9-04c1b626c333")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5679],{48717:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/history",function(){return n(52848)}])},41944:function(e,t,n){"use strict";var s=n(85893);t.Z=function(e){var t=e.title;return(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-lg font-bold",children:t})})}},761:function(e,t,n){"use strict";var s=n(85893),i=n(45197);t.Z=function(){return(0,s.jsx)(i.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},52848:function(e,t,n){"use strict";n.r(t);var s=n(11010),i=n(91309),r=n(4586),a=n(97582),o=n(85893),c=n(67294),l=n(20975),u=n(11163),d=n(41192),f=n(27431),g=n(46273),m=n(99522),x=n(81231),h=n(41944),v=n(761),p=n(99019),y=BigInt(20);t.default=function(){var e=(0,u.useRouter)(),t=((0,c.useContext)(d.M)||{}).token,n=(0,l.m)().address,b=(0,i._)((0,c.useState)(BigInt(0)),2),j=b[0],N=b[1],I=(0,i._)((0,c.useState)(BigInt(0)),2),w=I[0],B=I[1],_=(0,i._)((0,c.useState)(!0),2),S=_[0],E=_[1],C=(0,i._)((0,c.useState)([]),2),k=C[0],P=C[1],T=(0,i._)((0,c.useState)(0),2),$=T[0],V=T[1],M=(0,c.useRef)(null),Z=(0,c.useMemo)(function(){return e.query.account||n},[e.query.account,n]),A=(0,g.Bk)(),H=A.currentRound,L=A.isPending,O=A.error;(0,c.useEffect)(function(){if(void 0!==H&&H>BigInt(0)){var e=H-y+BigInt(1)>BigInt(0)?H-y+BigInt(1):BigInt(1);B(H),N(e)}},[H]);var R=(0,f.a6)(null==t?void 0:t.address,Z,j,w),D=R.votingHistory,q=R.isPending,F=R.error;(0,c.useEffect)(function(){if((null==D?void 0:D.accountActions)&&(null==D?void 0:D.actionInfos)&&j!==BigInt(0)&&w!==BigInt(0)){var e=D.accountActions,t=D.actionInfos,n=new Map;t.forEach(function(e){n.set(e.head.id.toString(),e)});var s=new Map;e.forEach(function(e){var t=e.round.toString(),i=n.get(e.actionId.toString());if(i){var r=e.totalVoteCount>BigInt(0)?Number(e.myVoteCount*BigInt(1e4)/e.totalVoteCount)/100:0;s.has(t)||s.set(t,[]),s.get(t).push({actionInfo:i,votingAction:e,votePercentage:r})}});for(var i=[],a=w;a>=j;a--){var o=a.toString(),c=s.get(o)||[];c.sort(function(e,t){return e.actionInfo.head.id>t.actionInfo.head.id?-1:1}),i.push({round:a,actions:c,hasVoting:c.length>0})}P(function(e){var t=new Set(e.map(function(e){return e.round.toString()})),n=i.filter(function(e){return!t.has(e.round.toString())});return(0,r._)(e).concat((0,r._)(n)).sort(function(e,t){return e.round>t.round?-1:1})})}},[D,j,w]),(0,c.useEffect)(function(){E(j>BigInt(1))},[j]);var W=(0,i._)((0,c.useState)(!1),2),X=W[0],J=W[1],K=(0,c.useCallback)((0,s._)(function(){return(0,a.Jh)(this,function(e){return q||X||(J(!0),j>BigInt(1)&&N(j-y>=BigInt(1)?j-y:BigInt(1)),setTimeout(function(){J(!1)},1e3)),[2]})}),[q,X,j]);(0,c.useEffect)(function(){if(M.current){var e=M.current,t=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);/iPad|iPhone|iPod/.test(navigator.userAgent)&&window.MSStream;var n=null,s=null,i=function(){s&&clearTimeout(s),s=setTimeout(function(){var t=e.getBoundingClientRect(),n=window.innerHeight;t.top<=n+150&&S&&!q&&!X&&K()},100)};"IntersectionObserver"in window&&(n=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&S&&!q&&!X&&K()})},{root:null,rootMargin:t?"80px":"100px",threshold:[0,.1,.25,.5,.75,1]})).observe(e);var r=document.documentElement||document.body;r.addEventListener("scroll",i,{passive:!0}),r.addEventListener("touchmove",i,{passive:!0}),setTimeout(function(){e.getBoundingClientRect().bottom<=window.innerHeight+80&&S&&!q&&setTimeout(function(){return K()},500)},1e3);var a=setTimeout(function(){S&&!q&&!X&&k.length>0&&(V(function(e){return e+1}),$>=2&&(K(),V(0)))},3e3);return function(){clearTimeout(a),n&&(n.unobserve(e),n.disconnect()),s&&clearTimeout(s),r.removeEventListener("scroll",i),r.removeEventListener("touchmove",i)}}},[K,S,q,X,$,k.length]);var Y=(0,m.S)().handleContractError;return(0,c.useEffect)(function(){O&&Y(O,"dataViewer"),F&&Y(F,"dataViewer")},[O,F,Y]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.Z,{title:"投票历史",showBackButton:!0}),(0,o.jsx)("main",{className:"flex-grow",style:{WebkitOverflowScrolling:"touch",overscrollBehaviorY:"contain",transformStyle:"preserve-3d"},children:t&&Z?(0,o.jsxs)("div",{className:"flex flex-col space-y-2 p-4",children:[(0,o.jsx)(h.Z,{title:"".concat(Z!==n?" 投票记录（".concat(Z&&!(Z.length<8)?"".concat(Z.slice(0,6),"...").concat(Z.slice(-4)):Z,"）"):"我的投票记录")}),L?(0,o.jsx)(v.Z,{}):0!==k.length||q?(0,o.jsxs)(o.Fragment,{children:[k.map(function(e){return(0,o.jsxs)("div",{className:"border border-gray-100 rounded-lg py-2 px-4 shadow-sm ".concat(e.hasVoting?"bg-white":"bg-gray-50"),children:[(0,o.jsxs)("div",{className:"flex items-center mb-2",children:[(0,o.jsx)("span",{className:"text-greyscale-500 mr-2",children:"轮次:"}),(0,o.jsx)("span",{className:"text-xl font-bold ".concat(e.hasVoting?"text-secondary":"text-gray-400"),children:(0,p.cK)(e.round,t).toString()})]}),e.hasVoting?(0,o.jsx)("div",{className:"space-y-4",children:e.actions.map(function(e){return(0,o.jsxs)("div",{className:"border-l-4 border-secondary/20 pl-4",children:[(0,o.jsxs)("div",{className:"flex items-baseline mb-2",children:[(0,o.jsx)("span",{className:"text-greyscale-500 mr-1",children:"No."}),(0,o.jsx)("span",{className:"text-secondary text-lg font-bold mr-2",children:e.actionInfo.head.id.toString()}),(0,o.jsx)("span",{className:"font-bold text-greyscale-800",children:e.actionInfo.body.title})]}),(0,o.jsxs)("div",{className:"flex items-center space-x-6 text-sm text-greyscale-600",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"mr-1",children:"投票数:"}),(0,o.jsx)("span",{className:"font-semibold text-secondary",children:(0,p.LH)(e.votingAction.myVoteCount)})]}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("span",{className:"mr-1",children:"占比:"}),(0,o.jsx)("span",{className:"font-semibold text-primary",children:(0,p.rl)(e.votePercentage)}),(0,o.jsx)("span",{className:"ml-2",children:"(总投票:"}),(0,o.jsxs)("span",{className:"font-semibold",children:[(0,p.LH)(e.votingAction.totalVoteCount),")"]})]})]})]},e.actionInfo.head.id.toString())})}):(0,o.jsx)("div",{className:"text-center text-greyscale-400",children:"该轮次没有投票"})]},e.round.toString())}),(0,o.jsx)("div",{ref:M,className:"h-24 flex justify-center items-center mt-4 mb-8 px-4",style:{minHeight:"96px",opacity:1,visibility:"visible",transform:"translateZ(0)"},children:q||X?(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,o.jsx)(v.Z,{}),(0,o.jsx)("span",{className:"text-sm text-gray-500",children:"正在加载更多轮次..."})]}):S?(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-2 cursor-pointer active:scale-95 transition-transform",onClick:function(){K()},children:[(0,o.jsx)("span",{className:"text-sm text-gray-500 text-center",children:"下滑自动加载更多轮次"}),(0,o.jsx)("span",{className:"text-xs text-gray-400 text-center",children:"或点击此处手动加载"}),(0,o.jsx)("div",{className:"w-8 h-1 bg-gray-200 rounded opacity-50 mt-2"})]}):k.length>0?(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,o.jsx)("span",{className:"text-sm text-gray-300",children:"已加载所有轮次"}),(0,o.jsx)("div",{className:"w-12 h-0.5 bg-gray-200 rounded opacity-30"})]}):null})]}):(0,o.jsx)("div",{className:"text-center text-greyscale-500 py-8",children:"没有投票记录"})]}):(0,o.jsx)(v.Z,{})})]})}},21803:function(e,t,n){"use strict";function s(e,t){let[n,s="0"]=e.split("."),i=n.startsWith("-");if(i&&(n=n.slice(1)),s=s.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${s}`))&&(n=`${BigInt(n)+1n}`),s="";else if(s.length>t){let[e,i,r]=[s.slice(0,t-1),s.slice(t-1,t),s.slice(t)],a=Math.round(Number(`${i}.${r}`));(s=a>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${a}`).length>t&&(s=s.slice(1),n=`${BigInt(n)+1n}`),s=s.slice(0,t)}else s=s.padEnd(t,"0");return BigInt(`${i?"-":""}${n}${s}`)}n.d(t,{v:function(){return s}})}},function(e){e.O(0,[7395,6457,8700,1985,7431,2888,9774,179],function(){return e(e.s=48717)}),_N_E=e.O()}]);