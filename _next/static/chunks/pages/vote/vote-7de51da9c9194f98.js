try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="9e3d2954-8811-4c7d-964f-901c0fb38621",e._sentryDebugIdIdentifier="sentry-dbid-9e3d2954-8811-4c7d-964f-901c0fb38621")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7060],{73148:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return n(21171)}])},42083:function(e,t,n){"use strict";var s=n(85893),r=n(23432);t.Z=function(){return(0,s.jsx)(r.Z,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})}},21171:function(e,t,n){"use strict";n.r(t);var s=n(11010),r=n(75766),i=n(72253),c=n(14932),l=n(91309),a=n(97582),d=n(85893),o=n(67294),u=n(11163),f=n(42130),m=n(86501),h=n(27245),g=n(41664),x=n.n(g),v=n(7080),b=n(92180),p=n(93950),y=n(73591),j=n(91529),N=n(93778),_=n(83494),w=n(42083),I=n(44576);t.default=function(){var e,t=((0,o.useContext)(N.M)||{}).token,n=(0,l._)((0,o.useState)({}),2),g=n[0],E=n[1],B=(0,f.m)().address,$=(0,v.Bk)(),k=$.currentRound,T=($.isPending,$.error),P=(0,u.useRouter)(),S=P.query.ids,C=(0,l._)((0,o.useState)([]),2),A=C[0],Z=C[1];(0,o.useEffect)(function(){S&&Z(S.split(",").map(function(e){return parseInt(e,10)}))},[S]),(0,o.useEffect)(function(){if(A.length>0&&0===Object.keys(g).length){if(1===A.length)E((0,r._)({},A[0],100));else{var e={},t=Math.floor(100/A.length);A.forEach(function(n,s){s===A.length-1?e[n]=100-t*(A.length-1):e[n]=t}),E(e)}}},[A,g]);var M=function(e,t){if(1===A.length){E((0,r._)({},e,t));return}var n=(0,c._)((0,i._)({},g),(0,r._)({},e,t)),s=A.slice(0,-1).reduce(function(e,t){return e+(n[t]||0)},0);if(s>100){m.Am.error("投票百分比之和不能超过100%");return}n[A[A.length-1]]=100-s,E(n)},D=(0,b.Ty)(null==t?void 0:t.address,B),L=D.validGovVotes,O=D.isPending,F=D.error,H=(0,v.VI)(null==t?void 0:t.address,k,B),R=H.votesNumByAccount,V=H.isPending,X=H.error,q=(null==A?void 0:A.map(function(e){return BigInt(e)}))||[],z=(0,p.fT)(null==t?void 0:t.address,q),G=z.actionInfos,J=z.isPending,W=z.error,K=(0,v.rv)(),Q=K.vote,U=K.isPending,Y=K.isConfirming,ee=K.isConfirmed,et=K.writeError,en=function(){if(L-R<BigInt(2))return m.Am.error("剩余票数不足，不能投票"),!1;var e=Object.values(g).reduce(function(e,t){return e+t},0);return!(A.length>1)||100===e||(m.Am.error("百分比之和必须为100"),!1)},es=(e=(0,s._)(function(){var e,n;return(0,a.Jh)(this,function(s){switch(s.label){case 0:if(!en())return[2];e=A.map(function(e){return BigInt(e)}),n=A.map(function(e){return BigInt(g[e]||0)*(L-R)/BigInt(100)}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Q(null==t?void 0:t.address,e,n)];case 2:return s.sent(),[3,4];case 3:return s.sent(),m.Am.error("提交失败，请重试"),[3,4];case 4:return[2]}})}),function(){return e.apply(this,arguments)}),er=(0,y.S)().handleContractError;return(0,o.useEffect)(function(){T&&er(T,"vote"),et&&er(et,"vote"),X&&er(X,"vote"),W&&er(W,"submit"),F&&er(F,"stake")},[T,et,W,F,X]),(0,o.useEffect)(function(){ee&&!et&&(m.Am.success("提交成功",{duration:2e3}),setTimeout(function(){P.push("/vote/actions/?symbol=".concat(null==t?void 0:t.symbol))},2e3))},[ee,et]),(0,o.useEffect)(function(){document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(_.Z,{title:"投票"}),(0,d.jsx)("main",{className:"flex-grow",children:!t||J?(0,d.jsx)(w.Z,{}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"stats w-full",children:(0,d.jsxs)("div",{className:"stat place-items-center",children:[(0,d.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,d.jsx)("div",{className:"stat-value text-secondary mt-2",children:O||V?(0,d.jsx)(w.Z,{}):(0,j.LH)(L-R||BigInt(0))}),(0,d.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,d.jsx)(x(),{href:"/gov/stakelp/?symbol=".concat(null==t?void 0:t.symbol),className:"text-secondary",children:"获取治理票"})]})]})}),(0,d.jsxs)("div",{className:"px-4",children:[(0,d.jsx)("div",{className:"space-y-4",children:null==G?void 0:G.map(function(e,n){var s=n===G.length-1,r=A.slice(0,-1).reduce(function(e,t){return e+(g[t]||0)},0);return(0,d.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,d.jsx)(x(),{href:"/action/detail?id=".concat(e.head.id,"&type=vote&symbol=").concat(t.symbol),className:"flex-grow",children:(0,d.jsxs)("div",{className:"font-semibold mb-2",children:[(0,d.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(e.head.id)}),(0,d.jsx)("span",{className:"text-greyscale-900",children:"".concat(e.body.title)})]})},e.head.id),(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"number",min:"1",max:"100",value:1===A.length?g[e.head.id.toString()]||100:s?100-r:g[e.head.id.toString()]||"",onChange:function(t){return M(e.head.id.toString(),Number(t.target.value))},className:"p-2 border rounded w-16",disabled:A.length>1&&s,placeholder:""}),"%"]})]},e.head.id)})}),(0,d.jsx)("div",{className:"flex justify-center mt-4",children:(0,d.jsx)(h.z,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:function(e){return e.currentTarget.blur()},onClick:es,disabled:U||Y||ee,children:U?"提交中...":Y?"确认中...":ee?"已提交":"提交投票"})})]}),(0,d.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,d.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,d.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,d.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,d.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,d.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,d.jsx)(I.Z,{isLoading:U||Y,text:U?"提交交易...":"确认交易..."})]})})]})}},21803:function(e,t,n){"use strict";function s(e,t){let[n,s="0"]=e.split("."),r=n.startsWith("-");if(r&&(n=n.slice(1)),s=s.replace(/(0+)$/,""),0===t)1===Math.round(Number(`.${s}`))&&(n=`${BigInt(n)+1n}`),s="";else if(s.length>t){let[e,r,i]=[s.slice(0,t-1),s.slice(t-1,t),s.slice(t)],c=Math.round(Number(`${r}.${i}`));(s=c>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${c}`).length>t&&(s=s.slice(1),n=`${BigInt(n)+1n}`),s=s.slice(0,t)}else s=s.padEnd(t,"0");return BigInt(`${r?"-":""}${n}${s}`)}n.d(t,{v:function(){return s}})}},function(e){e.O(0,[8239,367,3494,2252,3950,2180,2888,9774,179],function(){return e(e.s=73148)}),_N_E=e.O()}]);