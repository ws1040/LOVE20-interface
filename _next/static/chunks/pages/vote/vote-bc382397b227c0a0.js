(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5475],{12293:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});var r=t(37876),n=t(7446);let a=()=>(0,r.jsx)(n.A,{className:"mx-auto h-4 w-4 animate-spin text-greyscale-500"})},18449:(e,s,t)=>{"use strict";t.d(s,{X:()=>a});var r=t(76200);class n extends r.C{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function a(e,s){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new n({value:e});let[t,r="0"]=e.split("."),a=t.startsWith("-");if(a&&(t=t.slice(1)),r=r.replace(/(0+)$/,""),0===s)1===Math.round(Number(`.${r}`))&&(t=`${BigInt(t)+1n}`),r="";else if(r.length>s){let[e,n,a]=[r.slice(0,s-1),r.slice(s-1,s),r.slice(s)],l=Math.round(Number(`${n}.${a}`));(r=l>9?`${BigInt(e)+BigInt(1)}0`.padStart(e.length+1,"0"):`${e}${l}`).length>s&&(r=r.slice(1),t=`${BigInt(t)+1n}`),r=r.slice(0,s)}else r=r.padEnd(s,"0");return BigInt(`${a?"-":""}${t}${r}`)}},31517:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>$});var r=t(16927),n=t(3576),a=t(62701),l=t(40854),i=t(4902),c=t(37876),d=t(14232),o=t(89099),u=t(8047),m=t(97685),h=t(6960),x=t(48230),v=t.n(x),g=t(98684),f=t(19591),N=t(44769),b=t(20451),p=t(42038),j=t(20442),y=t(83416),w=t(60154),E=t(12293),_=t(99574);let $=()=>{var e=((0,d.useContext)(y.N)||{}).token,s=(0,l._)((0,d.useState)({}),2),t=s[0],x=s[1],$=(0,u.F)(),I=$.address,C=$.chain,B=(0,g.vC)(),P=B.currentRound,k=(B.isPending,B.error),A=(0,o.useRouter)(),R=A.query.ids,T=(0,l._)((0,d.useState)([]),2),F=T[0],S=T[1];(0,d.useEffect)(()=>{R&&S(R.split(",").map(e=>parseInt(e,10)))},[R]),(0,d.useEffect)(()=>{if(1===F.length)x({[F[0]]:100});else{var e={},s=Math.floor(100/F.length);F.forEach((t,r)=>{r===F.length-1?e[t]=100-s*(F.length-1):e[t]=s}),x(e)}},[F]);var M=(0,f.Fd)(null==e?void 0:e.address,I),L=M.validGovVotes,O=M.isPending,X=M.error,H=(0,g.Pb)(null==e?void 0:e.address,P,I),q=H.votesNumByAccount,D=H.isPending,G=H.error,J=(null==F?void 0:F.map(e=>BigInt(e)))||[],U=(0,N.ui)(null==e?void 0:e.address,J),V=U.actionInfos,W=U.isPending,Y=U.error,z=(0,g.eU)(),K=z.vote,Q=z.isPending,Z=z.isConfirming,ee=z.isConfirmed,es=z.writeError,et=(0,b.g)().handleContractError;return(0,d.useEffect)(()=>{k&&et(k,"vote"),es&&et(es,"vote"),G&&et(G,"vote"),Y&&et(Y,"submit"),X&&et(X,"stake")},[k,es,Y,X,G]),(0,d.useEffect)(()=>{ee&&!es&&(m.oR.success("提交成功",{duration:2e3}),setTimeout(()=>{A.push("/vote/actions/?symbol=".concat(null==e?void 0:e.symbol))},2e3))},[ee,es]),(0,d.useEffect)(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()},[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(w.A,{title:"投票"}),(0,c.jsx)("main",{className:"flex-grow",children:!e||W?(0,c.jsx)(E.A,{}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"stats w-full",children:(0,c.jsxs)("div",{className:"stat place-items-center",children:[(0,c.jsx)("div",{className:"stat-title text-sm",children:"我的剩余票数"}),(0,c.jsx)("div",{className:"stat-value text-secondary mt-2",children:O||D?(0,c.jsx)(E.A,{}):(0,j.NJ)(L-q||BigInt(0))}),(0,c.jsxs)("div",{className:"stat-desc text-sm mt-2",children:["如需更多票数，请先"," ",(0,c.jsx)(v(),{href:"/gov/stakelp/?symbol=".concat(null==e?void 0:e.symbol),className:"text-secondary",children:"获取治理票"})]})]})}),(0,c.jsxs)("div",{className:"px-4",children:[(0,c.jsx)("div",{className:"space-y-4",children:null==V?void 0:V.map((s,r)=>{var l=r===V.length-1,i=100-F.slice(0,-1).reduce((e,s)=>e+(t[s]||0),0);return(0,c.jsxs)("div",{className:"p-4 rounded-lg mb-4 flex justify-between items-center",children:[(0,c.jsx)(v(),{href:"/action/detail?id=".concat(s.head.id,"&type=vote&symbol=").concat(e.symbol),className:"flex-grow",children:(0,c.jsxs)("div",{className:"font-semibold mb-2",children:[(0,c.jsx)("span",{className:"text-greyscale-400 text-sm mr-1",children:"No.".concat(s.head.id)}),(0,c.jsx)("span",{className:"text-greyscale-900",children:"".concat(s.body.title)})]})},s.head.id),(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("input",{type:"number",min:l?i:1,max:"100",value:l?i:t[s.head.id]||"",onChange:e=>((e,s)=>{if(1!==F.length){var r=(0,a._)((0,n._)({},t),{[e]:s}),l=F.slice(0,-1).reduce((e,s)=>e+(r[s]||0),0);if(l>100)return void m.oR.error("投票百分比之和不能超过100%");r[F[F.length-1]]=100-l,x(r)}})(s.head.id,Number(e.target.value)),className:"p-2 border rounded w-16",disabled:1===F.length||l,placeholder:""}),"%"]})]},s.head.id)})}),(0,c.jsx)("div",{className:"flex justify-center mt-4",children:(0,c.jsx)(h.$,{className:"w-1/2 focus:outline-none focus:ring-0",onFocus:e=>e.currentTarget.blur(),onClick:()=>(0,r._)(function(){var s,r;return(0,i.YH)(this,function(n){switch(n.label){case 0:if(!((0,p.C)(C)&&(L-q<2n?(m.oR.error("剩余票数不足，不能投票"),!1):100===Object.values(t).reduce((e,s)=>e+s,0)||(m.oR.error("百分比之和必须为100"),!1))))return[2];s=F.map(e=>BigInt(e)),r=F.map(e=>BigInt(t[e]||0)*(L-q)/100n),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,K(null==e?void 0:e.address,s,r)];case 2:return n.sent(),[3,4];case 3:return console.error("投票提交失败:",n.sent()),m.oR.error("提交失败，请重试"),[3,4];case 4:return[2]}})})(),disabled:Q||Z||ee,children:Q?"提交中...":Z?"确认中...":ee?"已提交":"提交投票"})})]}),(0,c.jsx)("div",{className:"flex flex-col w-full p-4 mt-4",children:(0,c.jsxs)("div",{className:"bg-gray-100 text-greyscale-500 rounded-lg p-4 mb-8 text-sm",children:[(0,c.jsx)("div",{className:"text-base font-bold text-greyscale-700 pb-1",children:"注意："}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"1、每轮最大可投票数，等于您的治理票数；"}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"2、APP帮您自动计算并提交100%票数；"}),(0,c.jsx)("div",{className:"text-sm text-greyscale-500 pb-1",children:"3、投票时需持有完整数量的质押资产凭证：SL 类(流动性质押)、ST 类(代币质押)。"})]})}),(0,c.jsx)(_.A,{isLoading:Q||Z,text:Q?"提交交易...":"确认交易..."})]})})]})}},86504:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/vote/vote",function(){return t(31517)}])}},e=>{e.O(0,[3308,7460,8230,154,3096,4769,6952,636,6593,8792],()=>e(e.s=86504)),_N_E=e.O()}]);