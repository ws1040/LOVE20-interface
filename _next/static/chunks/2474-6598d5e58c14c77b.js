"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2474],{92474:(e,s,t)=>{t.d(s,{A:()=>T});var n=t(16927),r=t(40854),l=t(4902),a=t(37876),c=t(6960),i=t(97685),d=t(8047),o=t(1081),m=t(14232),x=t(48230),u=t.n(x),h=t(42038),v=t(20442),j=t(4066),f=t(4113),b=t(19591),N=t(42472),y=t(67121),g=t(9215),k=t(75695),p=t(87577),A=t(12293),w=t(99574),C=t(99742);let T=e=>{var s=e.token,t=e.enableWithdraw,x=void 0!==t&&t,T=(0,d.F)().address,_=(0,o.i)(),E=(0,b.vC)(x),S=E.currentRound,P=E.isPending,R=E.error,D=(0,b.n3)(null==s?void 0:s.address,T),L=D.slAmount,$=D.stAmount,W=D.promisedWaitingPhases,F=D.requestedUnstakeRound,H=D.govVotes,U=D.isPending,B=D.error,I=()=>!!(0,h.z)(_)&&(!!L&&!(L<=0n)||(i.oR.error("流动性质押数量为0，不用取消质押"),!1)),K=(0,g.Gp)(null==s?void 0:s.slTokenAddress,T,C.env.NEXT_PUBLIC_CONTRACT_ADDRESS_STAKE,x),O=K.allowance,X=K.isPending,Y=K.error,z=(0,g.Gp)(null==s?void 0:s.stTokenAddress,T,C.env.NEXT_PUBLIC_CONTRACT_ADDRESS_STAKE,x),G=z.allowance,J=z.isPending,q=z.error,V=(0,b.Fd)((null==s?void 0:s.address)||"",T||""),Z=V.validGovVotes;V.isPending,V.error;var M=(0,r._)((0,m.useState)(!1),2),Q=M[0],ee=M[1],es=(0,r._)((0,m.useState)(!1),2),et=es[0],en=es[1],er=(0,N.zH)(null==s?void 0:s.stTokenAddress),el=er.isPending,ea=er.isConfirming,ec=er.isConfirmed,ei=er.writeError,ed=er.approve,eo=(0,y.zH)(null==s?void 0:s.slTokenAddress),em=eo.isPending,ex=eo.isConfirming,eu=eo.isConfirmed,eh=eo.writeError,ev=eo.approve;(0,m.useEffect)(()=>{eu||L&&L>0n&&O&&O>=L?ee(!0):ee(!1)},[L,O,X,eu]),(0,m.useEffect)(()=>{ec||!$||$<=0n||G&&G>=$?en(!0):en(!1)},[$,G,J,ec]);var ej=(0,b.Zh)(),ef=ej.isWriting,eb=ej.isConfirming,eN=ej.isConfirmed,ey=ej.writeError,eg=ej.unstake;(0,m.useEffect)(()=>{eN&&(i.oR.success("取消质押成功"),setTimeout(()=>{window.location.href="".concat("/interface","/my?symbol=").concat(null==s?void 0:s.symbol)},2e3))},[eN]);var ek=(0,b.S1)(),ep=ek.isWriting,eA=ek.isConfirming,ew=ek.isConfirmed,eC=ek.writeError,eT=ek.withdraw;(0,m.useEffect)(()=>{ew&&(i.oR.success("取回代币成功"),setTimeout(()=>{window.location.href="".concat("/interface","/my?symbol=").concat(null==s?void 0:s.symbol)},2e3))},[ew]);var e_=(0,f.g)().handleContractError;if((0,m.useEffect)(()=>{B&&e_(B,"stake"),ei&&e_(ei,"stToken"),eh&&e_(eh,"slToken"),ey&&e_(ey,"stake"),eC&&e_(eC,"stake"),R&&e_(R,"stake"),Y&&e_(Y,"slToken"),q&&e_(q,"stToken")},[B,ei,eh,ey,eC,R,Y,q]),!T)return(0,a.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"请先连接钱包"});if(!s||x&&P||U)return(0,a.jsx)(A.A,{});if(!U&&!L)return(0,a.jsx)("div",{className:"text-sm mt-4 text-greyscale-500 text-center",children:"您没有质押"});var eE=em||ex,eS=el||ea,eP=Q&&et,eR=F&&S>F+(W||BigInt(0));return console.log("---------------begin----------------"),console.log("canWithdraw",eR),console.log("enableWithdraw",x),console.log("requestedUnstakeRound",F),console.log("currentRound",S),console.log("promisedWaitingPhases",W),console.log("----------------end----------------"),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0 ",children:[(0,a.jsxs)("div",{className:"stat place-items-center pt-0 pb-1 pl-1",children:[(0,a.jsx)("div",{className:"stat-title text-sm",children:"我的治理票数"}),(0,a.jsx)("div",{className:"stat-value text-xl text-secondary",children:U?(0,a.jsx)(A.A,{}):(0,v.NJ)(H||0n)}),(0,a.jsx)("div",{className:"stat-desc text-xs mb-2 mt-1",children:F&&F>0n&&"注意：解锁期内治理票数为0"})]}),(0,a.jsxs)("div",{className:"stat place-items-center pt-0 pb-1 pl-1",children:[(0,a.jsx)("div",{className:"stat-title text-sm",children:"我承诺的解锁期"}),(0,a.jsxs)("div",{className:"stat-value text-lg",children:[(0,a.jsx)("span",{className:"text-secondary",children:U?(0,a.jsx)(A.A,{}):"".concat(W||0n," ")}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:" 阶段"})]}),(0,a.jsx)("div",{className:"stat-desc text-xs mb-2 mt-1",children:"".concat((0,j.u$)(Number(W||0n),!0))})]})]}),(0,a.jsxs)("div",{className:"stats w-full grid grid-cols-2 divide-x-0",children:[(0,a.jsxs)("div",{className:"stat place-items-center pt-0 pb-1 pl-1",children:[(0,a.jsxs)("div",{className:"stat-title text-sm flex items-center",children:["流动性质押凭证SL代币",(0,a.jsx)(p.A,{address:s.slTokenAddress,showAddress:!1}),(0,a.jsx)(k.A,{tokenAddress:s.slTokenAddress,tokenSymbol:"sl"+s.symbol,tokenDecimals:s.decimals})]}),(0,a.jsx)("div",{className:"stat-value text-xl text-gray-600",children:U?(0,a.jsx)(A.A,{}):(0,v.NJ)(L||0n)}),(0,a.jsx)("div",{className:"stat-desc text-xs",children:(0,a.jsx)(c.$,{variant:"link",className:"text-secondary font-normal border-secondary",asChild:!0,children:(0,a.jsx)(u(),{href:"/gov/stakelp/?symbol=".concat(s.symbol),children:"质押 获取治理票\xa0>>"})})})]}),(0,a.jsxs)("div",{className:"stat place-items-center pt-0 pb-1 pl-3",children:[(0,a.jsxs)("div",{className:"stat-title text-sm flex items-center",children:["代币质押凭证ST代币",(0,a.jsx)(p.A,{address:s.stTokenAddress,showAddress:!1}),(0,a.jsx)(k.A,{tokenAddress:s.stTokenAddress,tokenSymbol:"st"+s.symbol,tokenDecimals:s.decimals})]}),(0,a.jsx)("div",{className:"stat-value text-xl text-gray-600",children:U?(0,a.jsx)(A.A,{}):(0,v.NJ)($||0n)}),(0,a.jsx)("div",{className:"stat-desc text-xs",children:(0,a.jsx)(c.$,{variant:"link",className:"text-secondary font-normal border-secondary",asChild:!0,children:(0,a.jsx)(u(),{href:"/gov/staketoken?symbol=".concat(s.symbol),children:"质押 增加治理收益\xa0>>"})})})]})]}),Z<=0n&&H&&H>0n&&(0,a.jsx)("div",{className:"text-sm mb-4 text-greyscale-500 text-center",children:(0,a.jsx)("div",{className:"text-red-500",children:"当前 sl 或 st 代币余额不足，导致有效治理票为0，请及时补足"})}),x&&(0,a.jsxs)(a.Fragment,{children:[!F&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-center space-x-2 mt-2",children:[(0,a.jsx)(c.$,{className:"w-1/3",onClick:()=>(0,n._)(function(){return(0,l.YH)(this,function(e){switch(e.label){case 0:if(!I())return[2];e.label=1;case 1:if(e.trys.push([1,4,,5]),!(L&&L>0n&&!Q))return[3,3];return[4,ev(C.env.NEXT_PUBLIC_CONTRACT_ADDRESS_STAKE,L)];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:return console.error(e.sent()),[3,5];case 5:return[2]}})})(),disabled:eE||Q,children:eE?"1.提交中...":ex?"1.确认中...":Q?"1.sl".concat(null==s?void 0:s.symbol," 已授权"):"1.授权 sl".concat(null==s?void 0:s.symbol)}),(0,a.jsx)(c.$,{className:"w-1/3",onClick:()=>(0,n._)(function(){return(0,l.YH)(this,function(e){switch(e.label){case 0:if(!I())return[2];e.label=1;case 1:if(e.trys.push([1,4,,5]),!($&&$>0n&&!et))return[3,3];return[4,ed(C.env.NEXT_PUBLIC_CONTRACT_ADDRESS_STAKE,$)];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:return console.error(e.sent()),[3,5];case 5:return[2]}})})(),disabled:!Q||eS||et,children:eS?"2.提交中...":ea?"2.确认中...":et?"2.st".concat(null==s?void 0:s.symbol," 已授权"):"2.授权 st".concat(null==s?void 0:s.symbol)}),(0,a.jsx)(c.$,{className:"w-1/3",onClick:()=>(0,n._)(function(){return(0,l.YH)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,eg(null==s?void 0:s.address)];case 1:return e.sent(),[3,3];case 2:return console.error(e.sent()),[3,3];case 3:return[2]}})})(),disabled:!eP||ef||eb||eN,children:ef?"3.提交中":eb?"3.确认中":eN?"3.已取消质押":"3.取消质押"})]}),(0,a.jsxs)("div",{className:"text-center mt-4 text-sm text-greyscale-600",children:["解锁期，是从取消质押的阶段结束时开始计算",(0,a.jsx)("br",{}),"（现在取消质押后，投票轮第",(0,a.jsx)("span",{className:"text-secondary mx-1",children:"".concat((0,v.LP)(S,s)+(W||0n)+1n," ")}),"轮才能取回代币）"]})]}),F&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"flex w-full justify-center mt-2",children:(0,a.jsx)(c.$,{className:"w-1/2",onClick:()=>(0,n._)(function(){return(0,l.YH)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,eT(null==s?void 0:s.address)];case 1:return e.sent(),[3,3];case 2:return console.error(e.sent()),[3,3];case 3:return[2]}})})(),disabled:!eR||ep||eA||ew,children:eR?ep?"提交中":eA?"确认中":ew?"已取回":"取回质押代币":"已取消,第"+((0,v.LP)(F,s)+(W||0n)+1n)+"轮才可取回"})})})]}),!x&&(0,a.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,a.jsx)(c.$,{variant:"outline",className:"w-1/2 text-secondary border-secondary",asChild:!0,children:(0,a.jsx)(u(),{href:"/my/govrewards?symbol=".concat(s.symbol),children:"铸造治理奖励"})}),F&&(0,a.jsx)(c.$,{variant:"outline",className:"w-1/2 ".concat(eR?"text-secondary border-secondary":"text-greyscale-400 border-greyscale-400"," "),disabled:!eR,asChild:!0,children:(0,a.jsx)(u(),{href:"/gov/unstake/?symbol=".concat(s.symbol),children:eR?"取回质押代币":"已取消, 第"+((0,v.LP)(F,s)+(W||0n)+1n)+"轮可取回"})})]}),(0,a.jsx)(w.A,{isLoading:eE||eS||ep||ef||eA||eb,text:em||el||ep||ef?"提交交易...":"确认交易..."})]})}}}]);